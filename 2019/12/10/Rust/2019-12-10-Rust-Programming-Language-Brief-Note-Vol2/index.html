<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  
  <meta name="description" content="Yam | AI | NLP | 人工智能 | 哲学 | 自然语言处理 | 机器学习" />
  

  
  
  
  
  
  <title>The Rust Programming Language Brief Note (Vol2) | Yam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="8 Common Collections8.1 Storing Lists of Values with Vectors8.1.1 Create a New Vector8.1.2 Updating a Vector8.1.3 Dropping a Vector Drops Its Elements8.1.4 Reading Elements of Vectors8.1.5 Iterating o">
<meta name="keywords" content="Rust">
<meta property="og:type" content="article">
<meta property="og:title" content="The Rust Programming Language Brief Note (Vol2)">
<meta property="og:url" content="https://www.yam.gift/2019/12/10/Rust/2019-12-10-Rust-Programming-Language-Brief-Note-Vol2/index.html">
<meta property="og:site_name" content="Yam">
<meta property="og:description" content="8 Common Collections8.1 Storing Lists of Values with Vectors8.1.1 Create a New Vector8.1.2 Updating a Vector8.1.3 Dropping a Vector Drops Its Elements8.1.4 Reading Elements of Vectors8.1.5 Iterating o">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-12-11T04:07:22.410Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The Rust Programming Language Brief Note (Vol2)">
<meta name="twitter:description" content="8 Common Collections8.1 Storing Lists of Values with Vectors8.1.1 Create a New Vector8.1.2 Updating a Vector8.1.3 Dropping a Vector Drops Its Elements8.1.4 Reading Elements of Vectors8.1.5 Iterating o">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
  <!-- baidu webmaster push --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body class="home blog custom-background custom-font-enabled single-author">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="Yam" rel="home">Yam</a>
      </h1>
      
        <h2 class="site-description">
          <a href="/" id="subtitle">Feeling, Coding, Thinking</a>
        </h2>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/series/">Series</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives/">Archives</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/about/">About</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://github.com/hscspring">Projects</a></li>
                
                </ul>
            </div>
    </nav>
</header>
      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main"><article id="post-Rust/2019-12-10-Rust-Programming-Language-Brief-Note-Vol2" class="post-Rust/2019-12-10-Rust-Programming-Language-Brief-Note-Vol2 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title article-title">
      The Rust Programming Language Brief Note (Vol2)
    </h1>
  

        
        <!-- <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="https://www.yam.gift/2019/12/10/Rust/2019-12-10-Rust-Programming-Language-Brief-Note-Vol2/" data-id="ck3zcexc400000yccg6uilx84" class="leave-reply bdsharebuttonbox" data-cmd="more">undefined</a>
        </div> --><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
            <!-- Table of Contents -->
              
        <p><div class="toc"><ul class="toc-item"><li><span><a href="#8-Common-Collections" data-toc-modified-id="8-Common-Collections-1">8 Common Collections</a></span><ul class="toc-item"><li><span><a href="#8.1-Storing-Lists-of-Values-with-Vectors" data-toc-modified-id="8.1-Storing-Lists-of-Values-with-Vectors-1.1">8.1 Storing Lists of Values with Vectors</a></span><ul class="toc-item"><li><span><a href="#8.1.1-Create-a-New-Vector" data-toc-modified-id="8.1.1-Create-a-New-Vector-1.1.1">8.1.1 Create a New Vector</a></span></li><li><span><a href="#8.1.2-Updating-a-Vector" data-toc-modified-id="8.1.2-Updating-a-Vector-1.1.2">8.1.2 Updating a Vector</a></span></li><li><span><a href="#8.1.3-Dropping-a-Vector-Drops-Its-Elements" data-toc-modified-id="8.1.3-Dropping-a-Vector-Drops-Its-Elements-1.1.3">8.1.3 Dropping a Vector Drops Its Elements</a></span></li><li><span><a href="#8.1.4-Reading-Elements-of-Vectors" data-toc-modified-id="8.1.4-Reading-Elements-of-Vectors-1.1.4">8.1.4 Reading Elements of Vectors</a></span></li><li><span><a href="#8.1.5-Iterating-over-the-Values-in-a-Vector" data-toc-modified-id="8.1.5-Iterating-over-the-Values-in-a-Vector-1.1.5">8.1.5 Iterating over the Values in a Vector</a></span></li><li><span><a href="#8.1.6-Using-an-Enum-to-Store-Multiple-Types" data-toc-modified-id="8.1.6-Using-an-Enum-to-Store-Multiple-Types-1.1.6">8.1.6 Using an Enum to Store Multiple Types</a></span></li></ul></li><li><span><a href="#8.2-Storing-UTF-8-Encoded-Text-with-Strings" data-toc-modified-id="8.2-Storing-UTF-8-Encoded-Text-with-Strings-1.2">8.2 Storing UTF-8 Encoded Text with Strings</a></span><ul class="toc-item"><li><span><a href="#8.2.1-What-Is-a-String?" data-toc-modified-id="8.2.1-What-Is-a-String?-1.2.1">8.2.1 What Is a String?</a></span></li><li><span><a href="#8.2.2-Creating-a-New-String" data-toc-modified-id="8.2.2-Creating-a-New-String-1.2.2">8.2.2 Creating a New String</a></span></li><li><span><a href="#8.2.3-Updating-a-String" data-toc-modified-id="8.2.3-Updating-a-String-1.2.3">8.2.3 Updating a String</a></span><ul class="toc-item"><li><span><a href="#8.2.3.1-Appending-to-a-String-with-push_str-and-push" data-toc-modified-id="8.2.3.1-Appending-to-a-String-with-push_str-and-push-1.2.3.1">8.2.3.1 Appending to a String with <code>push_str</code> and <code>push</code></a></span></li><li><span><a href="#8.2.3.2-Concatenation-with-the-+-Operator-or-the-format!-Macro" data-toc-modified-id="8.2.3.2-Concatenation-with-the-+-Operator-or-the-format!-Macro-1.2.3.2">8.2.3.2 Concatenation with the <code>+</code> Operator or the <code>format!</code> Macro</a></span></li></ul></li><li><span><a href="#8.2.4-Indexing-into-Strings" data-toc-modified-id="8.2.4-Indexing-into-Strings-1.2.4">8.2.4 Indexing into Strings</a></span><ul class="toc-item"><li><span><a href="#8.2.4.1-Internal-Representation" data-toc-modified-id="8.2.4.1-Internal-Representation-1.2.4.1">8.2.4.1 Internal Representation</a></span></li><li><span><a href="#Bytes-and-Scalar-Values-and-Grapheme-Clusters!-On-My!" data-toc-modified-id="Bytes-and-Scalar-Values-and-Grapheme-Clusters!-On-My!-1.2.4.2">Bytes and Scalar Values and Grapheme Clusters! On My!</a></span></li></ul></li><li><span><a href="#8.2.5-Slicing-Strings" data-toc-modified-id="8.2.5-Slicing-Strings-1.2.5">8.2.5 Slicing Strings</a></span></li><li><span><a href="#8.2.6-Methods-for-Iterating-Over-Strings" data-toc-modified-id="8.2.6-Methods-for-Iterating-Over-Strings-1.2.6">8.2.6 Methods for Iterating Over Strings</a></span></li><li><span><a href="#8.2.7-Exercise" data-toc-modified-id="8.2.7-Exercise-1.2.7">8.2.7 Exercise</a></span></li></ul></li><li><span><a href="#8.3-Storing-Keys-with-Associated-Values-in-Hash-Maps" data-toc-modified-id="8.3-Storing-Keys-with-Associated-Values-in-Hash-Maps-1.3">8.3 Storing Keys with Associated Values in Hash Maps</a></span><ul class="toc-item"><li><span><a href="#8.3.1-Creating-a-New-Hash-Map" data-toc-modified-id="8.3.1-Creating-a-New-Hash-Map-1.3.1">8.3.1 Creating a New Hash Map</a></span></li><li><span><a href="#8.3.2-Hash-Maps-and-Ownership" data-toc-modified-id="8.3.2-Hash-Maps-and-Ownership-1.3.2">8.3.2 Hash Maps and Ownership</a></span></li><li><span><a href="#8.3.3-Accessing-Values-in-a-Hash-Map" data-toc-modified-id="8.3.3-Accessing-Values-in-a-Hash-Map-1.3.3">8.3.3 Accessing Values in a Hash Map</a></span></li><li><span><a href="#8.3.4-Updating-a-Hash-Map" data-toc-modified-id="8.3.4-Updating-a-Hash-Map-1.3.4">8.3.4 Updating a Hash Map</a></span><ul class="toc-item"><li><span><a href="#8.3.4.1-Overwriting-a-Value" data-toc-modified-id="8.3.4.1-Overwriting-a-Value-1.3.4.1">8.3.4.1 Overwriting a Value</a></span></li><li><span><a href="#8.3.4.2-Only-Inserting-a-Value-If-the-Key-Has-No-Value" data-toc-modified-id="8.3.4.2-Only-Inserting-a-Value-If-the-Key-Has-No-Value-1.3.4.2">8.3.4.2 Only Inserting a Value If the Key Has No Value</a></span></li><li><span><a href="#8.3.4.3-Updating-a-Value-Based-on-the-Old-Value" data-toc-modified-id="8.3.4.3-Updating-a-Value-Based-on-the-Old-Value-1.3.4.3">8.3.4.3 Updating a Value Based on the Old Value</a></span></li></ul></li><li><span><a href="#8.3.5-Hashing-Functions" data-toc-modified-id="8.3.5-Hashing-Functions-1.3.5">8.3.5 Hashing Functions</a></span></li></ul></li></ul></li><li><span><a href="#9-Error-Handling" data-toc-modified-id="9-Error-Handling-2">9 Error Handling</a></span><ul class="toc-item"><li><span><a href="#9.1-Unrecoverable-Errors-with-panic!" data-toc-modified-id="9.1-Unrecoverable-Errors-with-panic!-2.1">9.1 Unrecoverable Errors with <code>panic!</code></a></span><ul class="toc-item"><li><span><a href="#9.1.1-Using-a-panic!-Backtrace" data-toc-modified-id="9.1.1-Using-a-panic!-Backtrace-2.1.1">9.1.1 Using a <code>panic!</code> Backtrace</a></span></li></ul></li><li><span><a href="#9.2-Recoverable-Errors-with-Result" data-toc-modified-id="9.2-Recoverable-Errors-with-Result-2.2">9.2 Recoverable Errors with Result</a></span><ul class="toc-item"><li><span><a href="#9.2.1-Matching-on-Different-Errors" data-toc-modified-id="9.2.1-Matching-on-Different-Errors-2.2.1">9.2.1 Matching on Different Errors</a></span></li><li><span><a href="#9.2.2-Shortcuts-for-Panic-on-Error:-unwrap-and-expect" data-toc-modified-id="9.2.2-Shortcuts-for-Panic-on-Error:-unwrap-and-expect-2.2.2">9.2.2 Shortcuts for Panic on Error: <code>unwrap</code> and <code>expect</code></a></span></li><li><span><a href="#9.2.3-Propagating-Errors" data-toc-modified-id="9.2.3-Propagating-Errors-2.2.3">9.2.3 Propagating Errors</a></span></li><li><span><a href="#9.2.4-A-Shortcut-for-Propagating-Errors:-the-?-Operator" data-toc-modified-id="9.2.4-A-Shortcut-for-Propagating-Errors:-the-?-Operator-2.2.4">9.2.4 A Shortcut for Propagating Errors: the <code>?</code> Operator</a></span></li><li><span><a href="#9.2.5-The-?-Operator-Can-Only-Be-Used-in-Functions-That-Return-Result" data-toc-modified-id="9.2.5-The-?-Operator-Can-Only-Be-Used-in-Functions-That-Return-Result-2.2.5">9.2.5 The <code>?</code> Operator Can Only Be Used in Functions That Return <code>Result</code></a></span></li></ul></li><li><span><a href="#9.3-To-panic!-or-Not-to-panic!" data-toc-modified-id="9.3-To-panic!-or-Not-to-panic!-2.3">9.3 To <code>panic!</code> or Not to <code>panic!</code></a></span><ul class="toc-item"><li><span><a href="#9.3.1-Examples,-Prototype-Code,-and-Tests" data-toc-modified-id="9.3.1-Examples,-Prototype-Code,-and-Tests-2.3.1">9.3.1 Examples, Prototype Code, and Tests</a></span></li><li><span><a href="#9.3.2-Cases-in-Which-You-Have-More-Information-Than-the-Compiler" data-toc-modified-id="9.3.2-Cases-in-Which-You-Have-More-Information-Than-the-Compiler-2.3.2">9.3.2 Cases in Which You Have More Information Than the Compiler</a></span></li><li><span><a href="#9.3.3-Guidelines-for-Error-Handling" data-toc-modified-id="9.3.3-Guidelines-for-Error-Handling-2.3.3">9.3.3 Guidelines for Error Handling</a></span></li><li><span><a href="#9.3.4-Creating-Custom-Types-for-Validation" data-toc-modified-id="9.3.4-Creating-Custom-Types-for-Validation-2.3.4">9.3.4 Creating Custom Types for Validation</a></span></li></ul></li></ul></li><li><span><a href="#10-Generic-Types,-Traits,-and-Lifetimes" data-toc-modified-id="10-Generic-Types,-Traits,-and-Lifetimes-3">10 Generic Types, Traits, and Lifetimes</a></span><ul class="toc-item"><li><span><a href="#10.1-Generic-Data-Types" data-toc-modified-id="10.1-Generic-Data-Types-3.1">10.1 Generic Data Types</a></span><ul class="toc-item"><li><span><a href="#10.1.1-In-Function-Definitions" data-toc-modified-id="10.1.1-In-Function-Definitions-3.1.1">10.1.1 In Function Definitions</a></span></li><li><span><a href="#10.1.2-In-Struct-Definitions" data-toc-modified-id="10.1.2-In-Struct-Definitions-3.1.2">10.1.2 In Struct Definitions</a></span></li><li><span><a href="#10.1.3-In-Enum-Definitions" data-toc-modified-id="10.1.3-In-Enum-Definitions-3.1.3">10.1.3 In Enum Definitions</a></span></li><li><span><a href="#10.1.4-In-Method-Definitions" data-toc-modified-id="10.1.4-In-Method-Definitions-3.1.4">10.1.4 In Method Definitions</a></span></li><li><span><a href="#10.1.5-Performance-of-Code-Using-Generics" data-toc-modified-id="10.1.5-Performance-of-Code-Using-Generics-3.1.5">10.1.5 Performance of Code Using Generics</a></span></li></ul></li><li><span><a href="#10.2-Traits:-Defining-Shared-Behavior" data-toc-modified-id="10.2-Traits:-Defining-Shared-Behavior-3.2">10.2 Traits: Defining Shared Behavior</a></span><ul class="toc-item"><li><span><a href="#10.2.1-Defining-a-Trait" data-toc-modified-id="10.2.1-Defining-a-Trait-3.2.1">10.2.1 Defining a Trait</a></span></li><li><span><a href="#10.2.2-Implementing-a-Trait-on-a-Type" data-toc-modified-id="10.2.2-Implementing-a-Trait-on-a-Type-3.2.2">10.2.2 Implementing a Trait on a Type</a></span></li><li><span><a href="#10.2.3-Default-Implementations" data-toc-modified-id="10.2.3-Default-Implementations-3.2.3">10.2.3 Default Implementations</a></span></li><li><span><a href="#10.2.4-Traits-as-Parameters" data-toc-modified-id="10.2.4-Traits-as-Parameters-3.2.4">10.2.4 Traits as Parameters</a></span><ul class="toc-item"><li><span><a href="#10.2.4.1-Trait-Bound-Syntax" data-toc-modified-id="10.2.4.1-Trait-Bound-Syntax-3.2.4.1">10.2.4.1 Trait Bound Syntax</a></span></li><li><span><a href="#10.2.4.2-Specifying-Multiple-Trait-Bounds-with-+-Syntax" data-toc-modified-id="10.2.4.2-Specifying-Multiple-Trait-Bounds-with-+-Syntax-3.2.4.2">10.2.4.2 Specifying Multiple Trait Bounds with <code>+</code> Syntax</a></span></li><li><span><a href="#10.2.4.3-Clearer-Trait-Bounds-with-where-Clauses" data-toc-modified-id="10.2.4.3-Clearer-Trait-Bounds-with-where-Clauses-3.2.4.3">10.2.4.3 Clearer Trait Bounds with <code>where</code> Clauses</a></span></li></ul></li><li><span><a href="#10.2.5-Returning-Types-that-Implement-Traits" data-toc-modified-id="10.2.5-Returning-Types-that-Implement-Traits-3.2.5">10.2.5 Returning Types that Implement Traits</a></span></li><li><span><a href="#10.2.6-Fixing-the-largest-Function-with-Trait-Bounds" data-toc-modified-id="10.2.6-Fixing-the-largest-Function-with-Trait-Bounds-3.2.6">10.2.6 Fixing the <code>largest</code> Function with Trait Bounds</a></span></li><li><span><a href="#10.2.7-Using-Trait-Bounds-to-Conditionally-Implement-Methods" data-toc-modified-id="10.2.7-Using-Trait-Bounds-to-Conditionally-Implement-Methods-3.2.7">10.2.7 Using Trait Bounds to Conditionally Implement Methods</a></span></li></ul></li><li><span><a href="#10.3-Validating-References-with-Lifetimes" data-toc-modified-id="10.3-Validating-References-with-Lifetimes-3.3">10.3 Validating References with Lifetimes</a></span><ul class="toc-item"><li><span><a href="#10.3.1-Preventing-Dangling-References-with-Lifetimes" data-toc-modified-id="10.3.1-Preventing-Dangling-References-with-Lifetimes-3.3.1">10.3.1 Preventing Dangling References with Lifetimes</a></span></li><li><span><a href="#10.3.2-The-Borrow-Checker" data-toc-modified-id="10.3.2-The-Borrow-Checker-3.3.2">10.3.2 The Borrow Checker</a></span></li><li><span><a href="#10.3.3-Generic-Lifetimes-in-Functions" data-toc-modified-id="10.3.3-Generic-Lifetimes-in-Functions-3.3.3">10.3.3 Generic Lifetimes in Functions</a></span></li><li><span><a href="#10.3.4-Lifetime-Annotation-Syntax" data-toc-modified-id="10.3.4-Lifetime-Annotation-Syntax-3.3.4">10.3.4 Lifetime Annotation Syntax</a></span></li><li><span><a href="#10.3.5-Lifetime-Annotations-in-Function-Signatures" data-toc-modified-id="10.3.5-Lifetime-Annotations-in-Function-Signatures-3.3.5">10.3.5 Lifetime Annotations in Function Signatures</a></span></li><li><span><a href="#10.3.6-Thinking-in-Terms-of-Lifetimes" data-toc-modified-id="10.3.6-Thinking-in-Terms-of-Lifetimes-3.3.6">10.3.6 Thinking in Terms of Lifetimes</a></span></li><li><span><a href="#10.3.7-Lifetime-Annotations-in-Struct-Definitions" data-toc-modified-id="10.3.7-Lifetime-Annotations-in-Struct-Definitions-3.3.7">10.3.7 Lifetime Annotations in Struct Definitions</a></span></li><li><span><a href="#10.3.8-Lifetime-Elision" data-toc-modified-id="10.3.8-Lifetime-Elision-3.3.8">10.3.8 Lifetime Elision</a></span></li><li><span><a href="#10.3.9-Lifetime-Annotations-in-Method-Definitions" data-toc-modified-id="10.3.9-Lifetime-Annotations-in-Method-Definitions-3.3.9">10.3.9 Lifetime Annotations in Method Definitions</a></span></li><li><span><a href="#10.3.10-The-Static-Lifetime" data-toc-modified-id="10.3.10-The-Static-Lifetime-3.3.10">10.3.10 The Static Lifetime</a></span></li></ul></li><li><span><a href="#10.4-Generic-Type-Parameters,-Trait-Bounds,-and-Lifetimes-Together" data-toc-modified-id="10.4-Generic-Type-Parameters,-Trait-Bounds,-and-Lifetimes-Together-3.4">10.4 Generic Type Parameters, Trait Bounds, and Lifetimes Together</a></span></li></ul></li><li><span><a href="#11-Writing-Automated-Tests" data-toc-modified-id="11-Writing-Automated-Tests-4">11 Writing Automated Tests</a></span><ul class="toc-item"><li><span><a href="#11.1-How-to-Write-Tests" data-toc-modified-id="11.1-How-to-Write-Tests-4.1">11.1 How to Write Tests</a></span><ul class="toc-item"><li><span><a href="#11.1.1-The-Anatomy-of-a-Test-Function" data-toc-modified-id="11.1.1-The-Anatomy-of-a-Test-Function-4.1.1">11.1.1 The Anatomy of a Test Function</a></span></li><li><span><a href="#11.1.2-Checking-Results-with-the-assert!-Macro" data-toc-modified-id="11.1.2-Checking-Results-with-the-assert!-Macro-4.1.2">11.1.2 Checking Results with the <code>assert!</code> Macro</a></span></li><li><span><a href="#11.1.3-Testing-Equality-with-the-assert_eq!-and-assert_ne!-Macros" data-toc-modified-id="11.1.3-Testing-Equality-with-the-assert_eq!-and-assert_ne!-Macros-4.1.3">11.1.3 Testing Equality with the <code>assert_eq!</code> and <code>assert_ne!</code> Macros</a></span></li><li><span><a href="#Adding-Custom-Failure-Messages" data-toc-modified-id="Adding-Custom-Failure-Messages-4.1.4">Adding Custom Failure Messages</a></span></li><li><span><a href="#11.1.5-Checking-for-Panics-with-should_panic" data-toc-modified-id="11.1.5-Checking-for-Panics-with-should_panic-4.1.5">11.1.5 Checking for Panics with <code>should_panic</code></a></span></li><li><span><a href="#11.1.6-Using-Result<T,-E>-in-Tests" data-toc-modified-id="11.1.6-Using-Result<T,-E>-in-Tests-4.1.6">11.1.6 Using <code>Result&lt;T, E&gt;</code> in Tests</a></span></li></ul></li><li><span><a href="#11.2-Controlling-How-Tests-Are-Run" data-toc-modified-id="11.2-Controlling-How-Tests-Are-Run-4.2">11.2 Controlling How Tests Are Run</a></span><ul class="toc-item"><li><span><a href="#11.2.1-Running-Tests-in-Parallel-or-Consecutively" data-toc-modified-id="11.2.1-Running-Tests-in-Parallel-or-Consecutively-4.2.1">11.2.1 Running Tests in Parallel or Consecutively</a></span></li><li><span><a href="#11.2.2-Showing-Function-Output" data-toc-modified-id="11.2.2-Showing-Function-Output-4.2.2">11.2.2 Showing Function Output</a></span></li><li><span><a href="#11.2.3-Running-a-Subset-of-Tests-by-Name" data-toc-modified-id="11.2.3-Running-a-Subset-of-Tests-by-Name-4.2.3">11.2.3 Running a Subset of Tests by Name</a></span></li><li><span><a href="#11.2.4-Ignoring-Some-Tests-Unless-Specifically-Requested" data-toc-modified-id="11.2.4-Ignoring-Some-Tests-Unless-Specifically-Requested-4.2.4">11.2.4 Ignoring Some Tests Unless Specifically Requested</a></span></li></ul></li><li><span><a href="#11.3-Test-Organization" data-toc-modified-id="11.3-Test-Organization-4.3">11.3 Test Organization</a></span><ul class="toc-item"><li><span><a href="#11.3.1-Unit-Tests" data-toc-modified-id="11.3.1-Unit-Tests-4.3.1">11.3.1 Unit Tests</a></span><ul class="toc-item"><li><span><a href="#11.3.1.1-The-Tests-Module-and-#[cfg(test)]" data-toc-modified-id="11.3.1.1-The-Tests-Module-and-#[cfg(test)]-4.3.1.1">11.3.1.1 The Tests Module and <code>#[cfg(test)]</code></a></span></li><li><span><a href="#11.3.1.2-Testing-Private-Functions" data-toc-modified-id="11.3.1.2-Testing-Private-Functions-4.3.1.2">11.3.1.2 Testing Private Functions</a></span></li></ul></li><li><span><a href="#11.3.2-Integration-Tests" data-toc-modified-id="11.3.2-Integration-Tests-4.3.2">11.3.2 Integration Tests</a></span><ul class="toc-item"><li><span><a href="#11.3.2.1-The-tests-Directory" data-toc-modified-id="11.3.2.1-The-tests-Directory-4.3.2.1">11.3.2.1 The tests Directory</a></span></li><li><span><a href="#11.3.2.2-Submodules-in-Integration-Tests" data-toc-modified-id="11.3.2.2-Submodules-in-Integration-Tests-4.3.2.2">11.3.2.2 Submodules in Integration Tests</a></span></li><li><span><a href="#11.3.2.3-Integration-Tests-for-Binary-Crates" data-toc-modified-id="11.3.2.3-Integration-Tests-for-Binary-Crates-4.3.2.3">11.3.2.3 Integration Tests for Binary Crates</a></span></li></ul></li></ul></li></ul></li><li><span><a href="#12-An-I/O-Project:-Building-a-Command-Line-Program" data-toc-modified-id="12-An-I/O-Project:-Building-a-Command-Line-Program-5">12 An I/O Project: Building a Command Line Program</a></span></li><li><span><a href="#13-Functional-Language-Features:-Iterators-and-Closures" data-toc-modified-id="13-Functional-Language-Features:-Iterators-and-Closures-6">13 Functional Language Features: Iterators and Closures</a></span><ul class="toc-item"><li><span><a href="#13.1-Closures:-Anonymous-Functions" data-toc-modified-id="13.1-Closures:-Anonymous-Functions-6.1">13.1 Closures: Anonymous Functions</a></span><ul class="toc-item"><li><span><a href="#13.1.1-Creating-an-Abstraction-of-Behavior-with-Closures" data-toc-modified-id="13.1.1-Creating-an-Abstraction-of-Behavior-with-Closures-6.1.1">13.1.1 Creating an Abstraction of Behavior with Closures</a></span></li><li><span><a href="#13.1.2-Closure-Type-Inference-and-Annotation" data-toc-modified-id="13.1.2-Closure-Type-Inference-and-Annotation-6.1.2">13.1.2 Closure Type Inference and Annotation</a></span></li><li><span><a href="#13.1.3-Storing-Closures-Using-Generic-Parameters-and-the-Fn-Traits" data-toc-modified-id="13.1.3-Storing-Closures-Using-Generic-Parameters-and-the-Fn-Traits-6.1.3">13.1.3 Storing Closures Using Generic Parameters and the <code>Fn</code> Traits</a></span></li><li><span><a href="#13.1.4-Limitations-of-the-Cacher-Implementation" data-toc-modified-id="13.1.4-Limitations-of-the-Cacher-Implementation-6.1.4">13.1.4 Limitations of the <code>Cacher</code> Implementation</a></span></li><li><span><a href="#13.1.5-Capturing-the-Environment-with-Closures" data-toc-modified-id="13.1.5-Capturing-the-Environment-with-Closures-6.1.5">13.1.5 Capturing the Environment with Closures</a></span></li></ul></li><li><span><a href="#13.2-Processing-a-Series-of-Items-with-Iterators" data-toc-modified-id="13.2-Processing-a-Series-of-Items-with-Iterators-6.2">13.2 Processing a Series of Items with Iterators</a></span><ul class="toc-item"><li><span><a href="#13.2.1-The-Iterator-Trait-and-the-Next-Method" data-toc-modified-id="13.2.1-The-Iterator-Trait-and-the-Next-Method-6.2.1">13.2.1 The <code>Iterator</code> Trait and the <code>Next</code> Method</a></span></li><li><span><a href="#13.2.2-Methods-that-Consume-the-Iterator" data-toc-modified-id="13.2.2-Methods-that-Consume-the-Iterator-6.2.2">13.2.2 Methods that Consume the Iterator</a></span></li><li><span><a href="#13.2.3-Methods-that-Produce-Other-Iterators" data-toc-modified-id="13.2.3-Methods-that-Produce-Other-Iterators-6.2.3">13.2.3 Methods that Produce Other Iterators</a></span></li><li><span><a href="#13.2.4-Using-Closures-that-Capture-Their-Environment" data-toc-modified-id="13.2.4-Using-Closures-that-Capture-Their-Environment-6.2.4">13.2.4 Using Closures that Capture Their Environment</a></span></li><li><span><a href="#13.2.5-Creating-Our-Own-Iterators-with-the-Iterator-Trait" data-toc-modified-id="13.2.5-Creating-Our-Own-Iterators-with-the-Iterator-Trait-6.2.5">13.2.5 Creating Our Own Iterators with the <code>Iterator</code> Trait</a></span><ul class="toc-item"><li><span><a href="#13.2.5.1-Using-Our-Counter-Iterator's-next-method" data-toc-modified-id="13.2.5.1-Using-Our-Counter-Iterator's-next-method-6.2.5.1">13.2.5.1 Using Our <code>Counter</code> Iterator's <code>next</code> method</a></span></li><li><span><a href="#13.2.5.2-Using-Other-Iterator-Trait-Methods" data-toc-modified-id="13.2.5.2-Using-Other-Iterator-Trait-Methods-6.2.5.2">13.2.5.2 Using Other <code>Iterator</code> Trait Methods</a></span></li></ul></li></ul></li><li><span><a href="#13.3-Improving-Our-I/O-Project" data-toc-modified-id="13.3-Improving-Our-I/O-Project-6.3">13.3 Improving Our I/O Project</a></span><ul class="toc-item"><li><span><a href="#13.3.1-Removing-a-clone-Using-an-Iterator" data-toc-modified-id="13.3.1-Removing-a-clone-Using-an-Iterator-6.3.1">13.3.1 Removing a <code>clone</code> Using an Iterator</a></span><ul class="toc-item"><li><span><a href="#13.3.1.1-Using-the-Returned-Iterator-Directly" data-toc-modified-id="13.3.1.1-Using-the-Returned-Iterator-Directly-6.3.1.1">13.3.1.1 Using the Returned Iterator Directly</a></span></li><li><span><a href="#13.3.1.2-Using-Iterator-Trait-Methods-Instead-of-Indexing" data-toc-modified-id="13.3.1.2-Using-Iterator-Trait-Methods-Instead-of-Indexing-6.3.1.2">13.3.1.2 Using <code>Iterator</code> Trait Methods Instead of Indexing</a></span></li></ul></li><li><span><a href="#13.3.2-Making-Code-Clearer-with-Iterator-Adaptors" data-toc-modified-id="13.3.2-Making-Code-Clearer-with-Iterator-Adaptors-6.3.2">13.3.2 Making Code Clearer with Iterator Adaptors</a></span></li></ul></li><li><span><a href="#13.4-Comparing-Performance:-Loop-vs.-Iterators" data-toc-modified-id="13.4-Comparing-Performance:-Loop-vs.-Iterators-6.4">13.4 Comparing Performance: Loop vs. Iterators</a></span></li></ul></li><li><span><a href="#14-More-About-Cargo-and-Crates.io" data-toc-modified-id="14-More-About-Cargo-and-Crates.io-7">14 More About Cargo and Crates.io</a></span><ul class="toc-item"><li><span><a href="#14.1-Customizing-Builds-with-Release-Profiles" data-toc-modified-id="14.1-Customizing-Builds-with-Release-Profiles-7.1">14.1 Customizing Builds with Release Profiles</a></span></li><li><span><a href="#14.2-Publishing-a-Crate-to-Crates.io" data-toc-modified-id="14.2-Publishing-a-Crate-to-Crates.io-7.2">14.2 Publishing a Crate to Crates.io</a></span><ul class="toc-item"><li><span><a href="#14.2.1-Making-Useful-Documentation-Comments" data-toc-modified-id="14.2.1-Making-Useful-Documentation-Comments-7.2.1">14.2.1 Making Useful Documentation Comments</a></span></li><li><span><a href="#14.2.3-Setting-Up-a-Crates.io-Account" data-toc-modified-id="14.2.3-Setting-Up-a-Crates.io-Account-7.2.2">14.2.3 Setting Up a Crates.io Account</a></span></li><li><span><a href="#14.2.4-Adding-Metadata-to-a-New-Crate" data-toc-modified-id="14.2.4-Adding-Metadata-to-a-New-Crate-7.2.3">14.2.4 Adding Metadata to a New Crate</a></span></li><li><span><a href="#14.2.5-Publishing-to-Crates.io" data-toc-modified-id="14.2.5-Publishing-to-Crates.io-7.2.4">14.2.5 Publishing to Crates.io</a></span></li><li><span><a href="#14.2.6-Publishing-a-New-Version-of-an-Existing-Crate" data-toc-modified-id="14.2.6-Publishing-a-New-Version-of-an-Existing-Crate-7.2.5">14.2.6 Publishing a New Version of an Existing Crate</a></span></li><li><span><a href="#14.2.7-Removing-Versions-from-Crates.io-with-cargo-yank" data-toc-modified-id="14.2.7-Removing-Versions-from-Crates.io-with-cargo-yank-7.2.6">14.2.7 Removing Versions from Crates.io with <code>cargo yank</code></a></span></li></ul></li><li><span><a href="#14.3-Cargo-Workspaces" data-toc-modified-id="14.3-Cargo-Workspaces-7.3">14.3 Cargo Workspaces</a></span><ul class="toc-item"><li><span><a href="#14.3.1-Creating-a-Workspace" data-toc-modified-id="14.3.1-Creating-a-Workspace-7.3.1">14.3.1 Creating a Workspace</a></span></li><li><span><a href="#14.3.2-Creating-the-Second-Crate-in-the-Workspace" data-toc-modified-id="14.3.2-Creating-the-Second-Crate-in-the-Workspace-7.3.2">14.3.2 Creating the Second Crate in the Workspace</a></span><ul class="toc-item"><li><span><a href="#14.3.2.1-Depending-on-an-External-Crate-in-a-Workspace" data-toc-modified-id="14.3.2.1-Depending-on-an-External-Crate-in-a-Workspace-7.3.2.1">14.3.2.1 Depending on an External Crate in a Workspace</a></span></li><li><span><a href="#14.3.2.2-Adding-a-Test-to-a-Workspace" data-toc-modified-id="14.3.2.2-Adding-a-Test-to-a-Workspace-7.3.2.2">14.3.2.2 Adding a Test to a Workspace</a></span></li></ul></li></ul></li><li><span><a href="#14.4-Installing-Binaries-from-Crates.io-with-cargo-install" data-toc-modified-id="14.4-Installing-Binaries-from-Crates.io-with-cargo-install-7.4">14.4 Installing Binaries from Crates.io with <code>cargo install</code></a></span></li><li><span><a href="#14.5-Extending-Cargo-with-Custom-Commands" data-toc-modified-id="14.5-Extending-Cargo-with-Custom-Commands-7.5">14.5 Extending Cargo with Custom Commands</a></span></li></ul></li></ul></div><br><a href="https://doc.rust-lang.org/stable/book/" target="_blank" rel="noopener">The Rust Programming Language - The Rust Programming Language</a> Chap 8-14</p>
<a id="more"></a>
<h2 id="8-Common-Collections"><a href="#8-Common-Collections" class="headerlink" title="8 Common Collections"></a>8 Common Collections</h2><p> Unlike the built-in array and tuple types, the data these collections point to is stored on the heap, which means the amount of data does not need to be known at compile time and can grow or shrink as the program runs. </p>
<ul>
<li>A <em>vector</em> allows you to store a variable number of values next to each other.</li>
<li>A <em>string</em> is a collection of characters. We’ve mentioned the <code>String</code> type previously, but in this chapter we’ll talk about it in depth.</li>
<li>A <em>hash map</em> allows you to associate a value with a particular key. It’s a particular implementation of the more general data structure called a <em>map</em>.</li>
</ul>
<h3 id="8-1-Storing-Lists-of-Values-with-Vectors"><a href="#8-1-Storing-Lists-of-Values-with-Vectors" class="headerlink" title="8.1 Storing Lists of Values with Vectors"></a>8.1 Storing Lists of Values with Vectors</h3><p>Vectors can only store values of the same type. They are useful when you have a list of items, such as the lines of text in a file or the prices of items in a shopping cart.</p>
<h4 id="8-1-1-Create-a-New-Vector"><a href="#8-1-1-Create-a-New-Vector" class="headerlink" title="8.1.1 Create a New Vector"></a>8.1.1 Create a New Vector</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v: <span class="built_in">Vec</span>&lt;<span class="keyword">i32</span>&gt; = <span class="built_in">Vec</span>::new();</span><br><span class="line"><span class="keyword">let</span> v = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure>
<p> It’s more common to create a <code>Vec&lt;T&gt;</code> that has initial values, and Rust provides the <code>vec!</code> macro for convenience. </p>
<h4 id="8-1-2-Updating-a-Vector"><a href="#8-1-2-Updating-a-Vector" class="headerlink" title="8.1.2 Updating a Vector"></a>8.1.2 Updating a Vector</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> v = <span class="built_in">Vec</span>::new();</span><br><span class="line"></span><br><span class="line">v.push(<span class="number">5</span>);</span><br><span class="line">v.push(<span class="number">6</span>);</span><br></pre></td></tr></table></figure>
<p>The numbers we place inside are all of type <code>i32</code>, and Rust infers this from the data, so we don’t need the <code>Vec&lt;i32&gt;</code> annotation.</p>
<h4 id="8-1-3-Dropping-a-Vector-Drops-Its-Elements"><a href="#8-1-3-Dropping-a-Vector-Drops-Its-Elements" class="headerlink" title="8.1.3 Dropping a Vector Drops Its Elements"></a>8.1.3 Dropping a Vector Drops Its Elements</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> v = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">    <span class="comment">// do stuff with v</span></span><br><span class="line">&#125; <span class="comment">// &lt;- v goes out of scope and is freed here</span></span><br></pre></td></tr></table></figure>
<h4 id="8-1-4-Reading-Elements-of-Vectors"><a href="#8-1-4-Reading-Elements-of-Vectors" class="headerlink" title="8.1.4 Reading Elements of Vectors"></a>8.1.4 Reading Elements of Vectors</h4><p>Both methods of accessing a value in a vector, either with indexing syntax or the <code>get</code> method.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> third: &amp;<span class="keyword">i32</span> = &amp;v[<span class="number">2</span>];</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"The third element is &#123;&#125;"</span>, third);</span><br><span class="line"><span class="keyword">match</span> v.get(<span class="number">2</span>) &#123;</span><br><span class="line">    <span class="literal">Some</span>(third_or_other) =&gt; <span class="built_in">println!</span>(<span class="string">"The third element is &#123;&#125;"</span>, third_or_other),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">"There is no third element."</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> does_not_exist = &amp;v[<span class="number">100</span>]; <span class="comment">// will cause panic</span></span><br><span class="line"><span class="keyword">let</span> does_not_exist = v.get(<span class="number">100</span>); <span class="comment">// return None without panic</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> v = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> first = &amp;v[<span class="number">0</span>];</span><br><span class="line">v.push(<span class="number">6</span>);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"The first element is: &#123;&#125;"</span>, first);</span><br><span class="line"><span class="comment">// error[E0502]: cannot borrow `v` as mutable because it is also borrowed as immutable</span></span><br></pre></td></tr></table></figure>
<p>The code might look like it should work: why should a reference to the first element care about what changes at the end of the vector? This error is due to the way vectors work: adding a new element onto the end of the vector might require allocating new memory and copying the old elements to the new space, if there isn’t enough room to put all the elements next to each other where the vector currently is. In that case, the reference to the first element would be pointing to deallocated memory. The borrowing rules prevent programs from ending up in that situation.</p>
<h4 id="8-1-5-Iterating-over-the-Values-in-a-Vector"><a href="#8-1-5-Iterating-over-the-Values-in-a-Vector" class="headerlink" title="8.1.5 Iterating over the Values in a Vector"></a>8.1.5 Iterating over the Values in a Vector</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v = <span class="built_in">vec!</span>[<span class="number">100</span>, <span class="number">32</span>, <span class="number">57</span>];</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &amp;v &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> v = <span class="built_in">vec!</span>[<span class="number">100</span>, <span class="number">32</span>, <span class="number">57</span>];</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &amp;<span class="keyword">mut</span> v &#123;</span><br><span class="line">    *i += <span class="number">50</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// use * to get the value in i, just C</span></span><br></pre></td></tr></table></figure>
<h4 id="8-1-6-Using-an-Enum-to-Store-Multiple-Types"><a href="#8-1-6-Using-an-Enum-to-Store-Multiple-Types" class="headerlink" title="8.1.6 Using an Enum to Store Multiple Types"></a>8.1.6 Using an Enum to Store Multiple Types</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">SpreadsheetCell</span></span> &#123;</span><br><span class="line">    Int(<span class="keyword">i32</span>),</span><br><span class="line">    Float(<span class="keyword">f64</span>),</span><br><span class="line">    Text(<span class="built_in">String</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> row = <span class="built_in">vec!</span>[</span><br><span class="line">    SpreadsheetCell::Int(<span class="number">3</span>),</span><br><span class="line">    SpreadsheetCell::Text(<span class="built_in">String</span>::from(<span class="string">"blue"</span>)),</span><br><span class="line">    SpreadsheetCell::Float(<span class="number">10.12</span>),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>Rust needs to know what types will be in the vector at compile time so it knows exactly how much memory on the heap will be needed to store each element.</p>
<h3 id="8-2-Storing-UTF-8-Encoded-Text-with-Strings"><a href="#8-2-Storing-UTF-8-Encoded-Text-with-Strings" class="headerlink" title="8.2 Storing UTF-8 Encoded Text with Strings"></a>8.2 Storing UTF-8 Encoded Text with Strings</h3><h4 id="8-2-1-What-Is-a-String"><a href="#8-2-1-What-Is-a-String" class="headerlink" title="8.2.1 What Is a String?"></a>8.2.1 What Is a String?</h4><p>Rust’s standard library also includes a number of other string types, such as <code>OsString</code>, <code>OsStr</code>, <code>CString</code>, and <code>CStr</code>. These string types can store text in different encodings or be represented in memory in a different way.</p>
<h4 id="8-2-2-Creating-a-New-String"><a href="#8-2-2-Creating-a-New-String" class="headerlink" title="8.2.2 Creating a New String"></a>8.2.2 Creating a New String</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::new();</span><br><span class="line"><span class="keyword">let</span> data = <span class="string">"initial contents"</span>;</span><br><span class="line"><span class="keyword">let</span> s = data.to_string();</span><br><span class="line"><span class="keyword">let</span> s = <span class="string">"initial contents"</span>.to_string();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s = <span class="built_in">String</span>::from(<span class="string">"initial contents"</span>);</span><br><span class="line"><span class="keyword">let</span> hello = <span class="built_in">String</span>::from(<span class="string">"你好"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="8-2-3-Updating-a-String"><a href="#8-2-3-Updating-a-String" class="headerlink" title="8.2.3 Updating a String"></a>8.2.3 Updating a String</h4><h5 id="8-2-3-1-Appending-to-a-String-with-push-str-and-push"><a href="#8-2-3-1-Appending-to-a-String-with-push-str-and-push" class="headerlink" title="8.2.3.1 Appending to a String with push_str and push"></a>8.2.3.1 Appending to a String with <code>push_str</code> and <code>push</code></h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="string">"foo"</span>);</span><br><span class="line">s.push_str(<span class="string">"bar"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> s1 = <span class="built_in">String</span>::from(<span class="string">"foo"</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="string">"bar"</span>;</span><br><span class="line">s1.push_str(s2);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"s2 is &#123;&#125;"</span>, s2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::from(<span class="string">"lo"</span>);</span><br><span class="line">s.push(<span class="string">'l'</span>); <span class="comment">// must be char</span></span><br></pre></td></tr></table></figure>
<p>The <code>push_str</code> method takes a string slice because we don’t necessarily want to take ownership of the parameter. </p>
<h5 id="8-2-3-2-Concatenation-with-the-Operator-or-the-format-Macro"><a href="#8-2-3-2-Concatenation-with-the-Operator-or-the-format-Macro" class="headerlink" title="8.2.3.2 Concatenation with the + Operator or the format! Macro"></a>8.2.3.2 Concatenation with the <code>+</code> Operator or the <code>format!</code> Macro</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">"Hello, "</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="built_in">String</span>::from(<span class="string">"world!"</span>);</span><br><span class="line"><span class="keyword">let</span> s3 = s1 + &amp;s2; <span class="comment">// note s1 has been moved here and can no longer be used</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">add</span></span>(<span class="keyword">self</span>, s: &amp;<span class="keyword">str</span>) -&gt; <span class="built_in">String</span> &#123;</span><br></pre></td></tr></table></figure>
<p>First, <code>s2</code> has an <code>&amp;</code>, meaning that we’re adding a <em>reference</em> of the second string to the first string because of the <code>s</code> parameter in the <code>add</code> function: we can only add a <code>&amp;str</code> to a <code>String</code>; we can’t add two <code>String</code> values together. But wait—the type of <code>&amp;s2</code> is <code>&amp;String</code>, not <code>&amp;str</code>, as specified in the second parameter to <code>add</code>. So why does Listing 8-18 compile?</p>
<p>The reason we’re able to use <code>&amp;s2</code> in the call to <code>add</code> is that the compiler can <em>coerce</em> the <code>&amp;String</code>argument into a <code>&amp;str</code>. When we call the <code>add</code> method, Rust uses a <em>deref coercion</em>, which here turns <code>&amp;s2</code> into <code>&amp;s2[..]</code>.  Because <code>add</code> does not take ownership of the <code>s</code> parameter, <code>s2</code> will still be a valid <code>String</code> after this operation.</p>
<p>Second, we can see in the signature that <code>add</code> takes ownership of <code>self</code>, because <code>self</code> does <em>not</em> have an <code>&amp;</code>. This means <code>s1</code> in Listing 8-18 will be moved into the <code>add</code> call and no longer be valid after that. So although <code>let s3 = s1 + &amp;s2;</code> looks like it will copy both strings and create a new one, this statement actually takes ownership of <code>s1</code>, appends a copy of the contents of <code>s2</code>, and then returns ownership of the result. In other words, it looks like it’s making a lot of copies but isn’t; the implementation is more efficient than copying.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">"tic"</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="built_in">String</span>::from(<span class="string">"tac"</span>);</span><br><span class="line"><span class="keyword">let</span> s3 = <span class="built_in">String</span>::from(<span class="string">"toe"</span>);</span><br><span class="line"><span class="keyword">let</span> s = s1 + <span class="string">"-"</span> + &amp;s2 + <span class="string">"-"</span> + &amp;s3; <span class="comment">// tic-tac-toe</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s = <span class="built_in">format!</span>(<span class="string">"&#123;&#125;-&#123;&#125;-&#123;&#125;"</span>, s1, s2, s3); <span class="comment">// tic-tac-toe</span></span><br></pre></td></tr></table></figure>
<h4 id="8-2-4-Indexing-into-Strings"><a href="#8-2-4-Indexing-into-Strings" class="headerlink" title="8.2.4 Indexing into Strings"></a>8.2.4 Indexing into Strings</h4><p>Rust strings don’t support indexing. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">String</span>::from(<span class="string">"hello"</span>);</span><br><span class="line"><span class="keyword">let</span> h = s1[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// compile error</span></span><br></pre></td></tr></table></figure>
<h5 id="8-2-4-1-Internal-Representation"><a href="#8-2-4-1-Internal-Representation" class="headerlink" title="8.2.4.1 Internal Representation"></a>8.2.4.1 Internal Representation</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> hello = <span class="string">"Здравствуйте"</span>;</span><br><span class="line"><span class="keyword">let</span> answer = &amp;hello[<span class="number">0</span>]; <span class="comment">// `str` cannot be indexed by `&#123;integer&#125;`</span></span><br><span class="line"><span class="keyword">let</span> answer = &amp;hello[<span class="number">0</span>::<span class="number">1</span>]; <span class="comment">// 3, [0::3] Зд, д takes two bytes of storage</span></span><br></pre></td></tr></table></figure>
<h5 id="Bytes-and-Scalar-Values-and-Grapheme-Clusters-On-My"><a href="#Bytes-and-Scalar-Values-and-Grapheme-Clusters-On-My" class="headerlink" title="Bytes and Scalar Values and Grapheme Clusters! On My!"></a>Bytes and Scalar Values and Grapheme Clusters! On My!</h5><p>Another point about UTF-8 is that there are actually three relevant ways to look at strings from Rust’s perspective: as bytes, scalar values, and grapheme clusters (the closest thing to what we would call <em>letters</em>).</p>
<p>Rust provides different ways of interpreting the raw string data that computers store so that each program can choose the interpretation it needs, no matter what human language the data is in.</p>
<h4 id="8-2-5-Slicing-Strings"><a href="#8-2-5-Slicing-Strings" class="headerlink" title="8.2.5 Slicing Strings"></a>8.2.5 Slicing Strings</h4><p>Indexing into a string is often a bad idea because it’s not clear what the return type of the string-indexing operation should be: a byte value, a character, a grapheme cluster, or a string slice. Therefore, Rust asks you to be more specific if you really need to use indices to create string slices. To be more specific in your indexing and indicate that you want a string slice, rather than indexing using <code>[]</code> with a single number, you can use <code>[]</code> with a range to create a string slice containing particular bytes:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> hello = <span class="string">"Здравствуйте"</span>;</span><br><span class="line"><span class="keyword">let</span> s = &amp;hello[<span class="number">0</span>..<span class="number">3</span>];</span><br></pre></td></tr></table></figure>
<h4 id="8-2-6-Methods-for-Iterating-Over-Strings"><a href="#8-2-6-Methods-for-Iterating-Over-Strings" class="headerlink" title="8.2.6 Methods for Iterating Over Strings"></a>8.2.6 Methods for Iterating Over Strings</h4><p>Fortunately, you can access elements in a string in other ways. If you need to perform operations on individual Unicode scalar values, the best way to do so is to use the <code>chars</code> method. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">"नमस्ते"</span>.chars() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> <span class="string">"नमस्ते"</span>.bytes() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-2-7-Exercise"><a href="#8-2-7-Exercise" class="headerlink" title="8.2.7 Exercise"></a>8.2.7 Exercise</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">string_slice</span></span>(arg: &amp;<span class="keyword">str</span>) &#123; <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, arg); &#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">string</span></span>(arg: <span class="built_in">String</span>) &#123; <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, arg); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    string_slice(<span class="string">"blue"</span>);</span><br><span class="line">    string(<span class="string">"red"</span>.to_string());</span><br><span class="line">    string(<span class="built_in">String</span>::from(<span class="string">"hi"</span>));</span><br><span class="line">    string(<span class="string">"rust is fun!"</span>.to_owned());</span><br><span class="line">    string(<span class="string">"nice weather"</span>.into());</span><br><span class="line">    string(<span class="built_in">format!</span>(<span class="string">"Interpolation &#123;&#125;"</span>, <span class="string">"Station"</span>));</span><br><span class="line">    string_slice(&amp;<span class="built_in">String</span>::from(<span class="string">"abc"</span>)[<span class="number">0</span>..<span class="number">1</span>]);</span><br><span class="line">    string_slice(<span class="string">"  hello there "</span>.trim());</span><br><span class="line">    string(<span class="string">"Happy Monday!"</span>.to_string().replace(<span class="string">"Mon"</span>, <span class="string">"Tues"</span>));</span><br><span class="line">    string(<span class="string">"mY sHiFt KeY iS sTiCkY"</span>.to_lowercase());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-3-Storing-Keys-with-Associated-Values-in-Hash-Maps"><a href="#8-3-Storing-Keys-with-Associated-Values-in-Hash-Maps" class="headerlink" title="8.3 Storing Keys with Associated Values in Hash Maps"></a>8.3 Storing Keys with Associated Values in Hash Maps</h3><h4 id="8-3-1-Creating-a-New-Hash-Map"><a href="#8-3-1-Creating-a-New-Hash-Map" class="headerlink" title="8.3.1 Creating a New Hash Map"></a>8.3.1 Creating a New Hash Map</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> scores = HashMap::new();</span><br><span class="line">scores.insert(<span class="built_in">String</span>::from(<span class="string">"Blue"</span>), <span class="number">10</span>);</span><br><span class="line">scores.insert(<span class="built_in">String</span>::from(<span class="string">"Yellow"</span>), <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> teams  = <span class="built_in">vec!</span>[<span class="built_in">String</span>::from(<span class="string">"Blue"</span>), <span class="built_in">String</span>::from(<span class="string">"Yellow"</span>)];</span><br><span class="line"><span class="keyword">let</span> initial_scores = <span class="built_in">vec!</span>[<span class="number">10</span>, <span class="number">50</span>];</span><br><span class="line"><span class="keyword">let</span> scores: HashMap&lt;_, _&gt; = teams.iter().zip(initial_scores.iter()).collect(); <span class="comment">//like python</span></span><br></pre></td></tr></table></figure>
<p>Just like vectors, hash maps store their data on the heap. Like vectors, hash maps are homogeneous: all of the keys must have the same type, and all of the values must have the same type.</p>
<p>The type annotation <code>HashMap&lt;_, _&gt;</code> is needed here because it’s possible to <code>collect</code> into many different data structures and Rust doesn’t know which you want unless you specify. For the parameters for the key and value types, however, we use underscores, and Rust can infer the types that the hash map contains based on the types of the data in the vectors.</p>
<h4 id="8-3-2-Hash-Maps-and-Ownership"><a href="#8-3-2-Hash-Maps-and-Ownership" class="headerlink" title="8.3.2 Hash Maps and Ownership"></a>8.3.2 Hash Maps and Ownership</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> field_name = <span class="built_in">String</span>::from(<span class="string">"Favorite color"</span>);</span><br><span class="line"><span class="keyword">let</span> field_value = <span class="built_in">String</span>::from(<span class="string">"Blue"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> map = HashMap::new();</span><br><span class="line">map.insert(field_name, field_value);</span><br><span class="line"><span class="comment">// field_name and field_value are invalid at this point,</span></span><br></pre></td></tr></table></figure>
<p>We aren’t able to use the variables <code>field_name</code> and <code>field_value</code> after they’ve been moved into the hash map with the call to <code>insert</code>.</p>
<p>If we insert references to values into the hash map, the values won’t be moved into the hash map. The values that the references point to must be valid for at least as long as the hash map is valid. </p>
<h4 id="8-3-3-Accessing-Values-in-a-Hash-Map"><a href="#8-3-3-Accessing-Values-in-a-Hash-Map" class="headerlink" title="8.3.3 Accessing Values in a Hash Map"></a>8.3.3 Accessing Values in a Hash Map</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> team_name = <span class="built_in">String</span>::from(<span class="string">"Blue"</span>);</span><br><span class="line"><span class="keyword">let</span> score = scores.get(&amp;team_name);</span><br></pre></td></tr></table></figure>
<p><code>score</code> will have the value that’s associated with the Blue team, and the result will be <code>Some(&amp;10)</code>. The result is wrapped in <code>Some</code> because <code>get</code> returns an <code>Option&lt;&amp;V&gt;</code>; if there’s no value for that key in the hash map, <code>get</code> will return <code>None</code>. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (key, value) <span class="keyword">in</span> &amp;scores &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"&#123;&#125;: &#123;&#125;"</span>, key, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-3-4-Updating-a-Hash-Map"><a href="#8-3-4-Updating-a-Hash-Map" class="headerlink" title="8.3.4 Updating a Hash Map"></a>8.3.4 Updating a Hash Map</h4><h5 id="8-3-4-1-Overwriting-a-Value"><a href="#8-3-4-1-Overwriting-a-Value" class="headerlink" title="8.3.4.1 Overwriting a Value"></a>8.3.4.1 Overwriting a Value</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scores.insert(<span class="built_in">String</span>::from(<span class="string">"Blue"</span>), <span class="number">10</span>);</span><br><span class="line">scores.insert(<span class="built_in">String</span>::from(<span class="string">"Blue"</span>), <span class="number">25</span>);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"&#123;:?&#125;"</span>, scores); <span class="comment">// &#123;"Blue": 25&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="8-3-4-2-Only-Inserting-a-Value-If-the-Key-Has-No-Value"><a href="#8-3-4-2-Only-Inserting-a-Value-If-the-Key-Has-No-Value" class="headerlink" title="8.3.4.2 Only Inserting a Value If the Key Has No Value"></a>8.3.4.2 Only Inserting a Value If the Key Has No Value</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scores.entry(<span class="built_in">String</span>::from(<span class="string">"Yellow"</span>)).or_insert(<span class="number">50</span>);</span><br><span class="line">scores.entry(<span class="built_in">String</span>::from(<span class="string">"Blue"</span>)).or_insert(<span class="number">50</span>);</span><br></pre></td></tr></table></figure>
<p>The <code>or_insert</code> method on <code>Entry</code> is defined to return a mutable reference to the value for the corresponding <code>Entry</code> key if that key exists, and if not, inserts the parameter as the new value for this key and returns a mutable reference to the new value. This technique is much cleaner than writing the logic ourselves and, in addition, plays more nicely with the borrow checker.</p>
<h5 id="8-3-4-3-Updating-a-Value-Based-on-the-Old-Value"><a href="#8-3-4-3-Updating-a-Value-Based-on-the-Old-Value" class="headerlink" title="8.3.4.3 Updating a Value Based on the Old Value"></a>8.3.4.3 Updating a Value Based on the Old Value</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> text = <span class="string">"hello world wonderful world"</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut</span> map = HashMap::new();</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> text.split_whitespace() &#123;</span><br><span class="line">    <span class="keyword">let</span> count = map.entry(word).or_insert(<span class="number">0</span>);</span><br><span class="line">    *count += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"&#123;:?&#125;"</span>, map); <span class="comment">// &#123;"world": 2, "hello": 1, "wonderful": 1&#125;</span></span><br></pre></td></tr></table></figure>
<p>The <code>or_insert</code> method actually returns a mutable reference (<code>&amp;mut V</code>) to the value for this key.</p>
<h4 id="8-3-5-Hashing-Functions"><a href="#8-3-5-Hashing-Functions" class="headerlink" title="8.3.5 Hashing Functions"></a>8.3.5 Hashing Functions</h4><p>By default, <code>HashMap</code> uses a “cryptographically strong”<a href="https://doc.rust-lang.org/book/ch08-03-hash-maps.html#siphash" target="_blank" rel="noopener">1</a> hashing function that can provide resistance to Denial of Service (DoS) attacks. This is not the fastest hashing algorithm available, but the trade-off for better security that comes with the drop in performance is worth it. If you profile your code and find that the default hash function is too slow for your purposes, you can switch to another function by specifying a different <em>hasher</em>. A hasher is a type that implements the <code>BuildHasher</code> trait. </p>
<h2 id="9-Error-Handling"><a href="#9-Error-Handling" class="headerlink" title="9 Error Handling"></a>9 Error Handling</h2><p>Rust doesn’t have exceptions. Instead, it has the type <code>Result&lt;T, E&gt;</code> for recoverable errors and the <code>panic!</code> macro that stops execution when the program encounters an unrecoverable error. </p>
<h3 id="9-1-Unrecoverable-Errors-with-panic"><a href="#9-1-Unrecoverable-Errors-with-panic" class="headerlink" title="9.1 Unrecoverable Errors with panic!"></a>9.1 Unrecoverable Errors with <code>panic!</code></h3><p> When the <code>panic!</code> macro executes, your program will print a failure message, unwind and clean up the stack, and then quit. This most commonly occurs when a bug of some kind has been detected and it’s not clear to the programmer how to handle the error.</p>
<blockquote>
<p>By default, when a panic occurs, the program starts <em>unwinding</em>, which means Rust walks back up the stack and cleans up the data from each function it encounters. But this walking back and cleanup is a lot of work. The alternative is to immediately <em>abort</em>, which ends the program without cleaning up. Memory that the program was using will then need to be cleaned up by the operating system. If in your project you need to make the resulting binary as small as possible, you can switch from unwinding to aborting upon a panic by adding <code>panic = &#39;abort&#39;</code>to the appropriate <code>[profile]</code> sections in your <em>Cargo.toml</em> file. For example, if you want to abort on panic in release mode, add this:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;[profile.release]</span><br><span class="line">&gt;panic = 'abort'</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="built_in">panic!</span>(<span class="string">"crash and burn"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// thread 'main' panicked at 'crash and burn', src/main.rs:2:4</span></span><br><span class="line"><span class="comment">// note: Run with `RUST_BACKTRACE=1` for a backtrace.</span></span><br></pre></td></tr></table></figure>
<h4 id="9-1-1-Using-a-panic-Backtrace"><a href="#9-1-1-Using-a-panic-Backtrace" class="headerlink" title="9.1.1 Using a panic! Backtrace"></a>9.1.1 Using a <code>panic!</code> Backtrace</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> v = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    v[<span class="number">99</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// thread 'main' panicked at 'index out of bounds: the len is 3 but the index is 99', checkout/src/liballoc/vec.rs:1555:10</span></span><br><span class="line"><span class="comment">// note: Run with `RUST_BACKTRACE=1` for a backtrace.</span></span><br></pre></td></tr></table></figure>
<p>Other languages, like C, will attempt to give you exactly what you asked for in this situation, even though it isn’t what you want: you’ll get whatever is at the location in memory that would correspond to that element in the vector, even though the memory doesn’t belong to the vector. This is called a <em>buffer overread</em> and can lead to security vulnerabilities if an attacker is able to manipulate the index in such a way as to read data they shouldn’t be allowed to that is stored after the array.</p>
<p>To protect your program from this sort of vulnerability, if you try to read an element at an index that doesn’t exist, Rust will stop execution and refuse to continue.</p>
<p>This error points at a file we didn’t write, <em>vec.rs</em>. That’s the implementation of <code>Vec&lt;T&gt;</code> in the standard library. The code that gets run when we use <code>[]</code> on our vector <code>v</code> is in <em>vec.rs</em>, and that is where the <code>panic!</code> is actually happening.</p>
<p>The next note line tells us that we can set the <code>RUST_BACKTRACE</code> environment variable to get a backtrace of exactly what happened to cause the error. A <em>backtrace</em> is a list of all the functions that have been called to get to this point. Backtraces in Rust work as they do in other languages: the key to reading the backtrace is to start from the top and read until you see files you wrote. That’s the spot where the problem originated. The lines above the lines mentioning your files are code that your code called; the lines below are code that called your code. These lines might include core Rust code, standard library code, or crates that you’re using. Let’s try getting a backtrace by setting the <code>RUST_BACKTRACE</code> environment variable to any value except 0. </p>
<p><code>RUST_BACKTRACE=1 cargo run</code></p>
<p>Debug symbols are enabled by default when using <code>cargo build</code> or <code>cargo run</code> without the <code>--release</code> flag.</p>
<h3 id="9-2-Recoverable-Errors-with-Result"><a href="#9-2-Recoverable-Errors-with-Result" class="headerlink" title="9.2 Recoverable Errors with Result"></a>9.2 Recoverable Errors with Result</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> f = File::open(<span class="string">"hello.txt"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> f = <span class="keyword">match</span> f &#123;</span><br><span class="line">    	<span class="literal">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="literal">Err</span>(error) =&gt; &#123;</span><br><span class="line">        	<span class="built_in">panic!</span>(<span class="string">"There was a problem opening the file: &#123;:?&#125;"</span>, error)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The return type of the <code>File::open</code> function is a <code>Result&lt;T, E&gt;</code>. The generic parameter <code>T</code> has been filled in here with the type of the success value, <code>std::fs::File</code>, which is a file handle. The type of <code>E</code> used in the error value is <code>std::io::Error</code>.</p>
<h4 id="9-2-1-Matching-on-Different-Errors"><a href="#9-2-1-Matching-on-Different-Errors" class="headerlink" title="9.2.1 Matching on Different Errors"></a>9.2.1 Matching on Different Errors</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::ErrorKind;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> f = File::open(<span class="string">"hello.txt"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> f = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="literal">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="literal">Err</span>(error) =&gt; <span class="keyword">match</span> error.kind() &#123;</span><br><span class="line">            ErrorKind::NotFound =&gt; <span class="keyword">match</span> File::create(<span class="string">"hello.txt"</span>) &#123;</span><br><span class="line">                <span class="literal">Ok</span>(fc) =&gt; fc,</span><br><span class="line">                <span class="literal">Err</span>(e) =&gt; <span class="built_in">panic!</span>(<span class="string">"Tried to create file but there was a problem: &#123;:?&#125;"</span>, e),</span><br><span class="line">            &#125;,</span><br><span class="line">            other_error =&gt; <span class="built_in">panic!</span>(<span class="string">"There was a problem opening the file: &#123;:?&#125;"</span>, other_error),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A more seasoned Rustacean might write this code: </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::ErrorKind;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> f = File::open(<span class="string">"hello.txt"</span>).unwrap_or_else(|error| &#123;</span><br><span class="line">        <span class="keyword">if</span> error.kind() == ErrorKind::NotFound &#123;</span><br><span class="line">            File::create(<span class="string">"hello.txt"</span>).unwrap_or_else(|error| &#123;</span><br><span class="line">                <span class="built_in">panic!</span>(<span class="string">"Tried to create file but there was a problem: &#123;:?&#125;"</span>, error);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">"There was a problem opening the file: &#123;:?&#125;"</span>, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="9-2-2-Shortcuts-for-Panic-on-Error-unwrap-and-expect"><a href="#9-2-2-Shortcuts-for-Panic-on-Error-unwrap-and-expect" class="headerlink" title="9.2.2 Shortcuts for Panic on Error: unwrap and expect"></a>9.2.2 Shortcuts for Panic on Error: <code>unwrap</code> and <code>expect</code></h4><p><code>unwrap</code> is a shortcut method that is implemented just like the <code>match</code>expression, If the <code>Result</code> value is the <code>Ok</code> variant, <code>unwrap</code> will return the value inside the <code>Ok</code>. If the <code>Result</code> is the <code>Err</code> variant, <code>unwrap</code> will call the <code>panic!</code> macro for us. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> f = File::open(<span class="string">"hello.txt"</span>).unwrap();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value:</span></span><br></pre></td></tr></table></figure>
<p><code>expect</code>, which is similar to <code>unwrap</code>, lets us also choose the <code>panic!</code> error message. Using <code>expect</code> instead of <code>unwrap</code> and providing good error messages can convey your intent and make tracking down the source of a panic easier. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> f = File::open(<span class="string">"hello.txt"</span>).expect(<span class="string">"Failed to open hello.txt"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// thread 'main' panicked at 'Failed to open hello.txt:</span></span><br></pre></td></tr></table></figure>
<h4 id="9-2-3-Propagating-Errors"><a href="#9-2-3-Propagating-Errors" class="headerlink" title="9.2.3 Propagating Errors"></a>9.2.3 Propagating Errors</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::io::Read;</span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">read_username_from_file</span></span>() -&gt; <span class="built_in">Result</span>&lt;<span class="built_in">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="comment">// returning a value of the type Result&lt;T, E&gt; with String and io::Error</span></span><br><span class="line">    <span class="keyword">let</span> f = File::open(<span class="string">"hello.txt"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> f = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="literal">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="literal">Err</span>(e) =&gt; <span class="keyword">return</span> <span class="literal">Err</span>(e),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::new();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> f.read_to_string(&amp;<span class="keyword">mut</span> s) &#123;</span><br><span class="line">        <span class="literal">Ok</span>(_) =&gt; <span class="literal">Ok</span>(s),</span><br><span class="line">        <span class="literal">Err</span>(e) =&gt; <span class="literal">Err</span>(e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="9-2-4-A-Shortcut-for-Propagating-Errors-the-Operator"><a href="#9-2-4-A-Shortcut-for-Propagating-Errors-the-Operator" class="headerlink" title="9.2.4 A Shortcut for Propagating Errors: the ? Operator"></a>9.2.4 A Shortcut for Propagating Errors: the <code>?</code> Operator</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::io::Read;</span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">read_username_from_file</span></span>() -&gt; <span class="built_in">Result</span>&lt;<span class="built_in">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> f = File::open(<span class="string">"hello.txt"</span>)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::new();</span><br><span class="line">    f.read_to_string(&amp;<span class="keyword">mut</span> s)?;</span><br><span class="line">    <span class="literal">Ok</span>(s)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::io::Read;</span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">read_username_from_file</span></span>() -&gt; <span class="built_in">Result</span>&lt;<span class="built_in">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> s = <span class="built_in">String</span>::new();</span><br><span class="line">    File::open(<span class="string">"hello.txt"</span>)?.read_to_string(&amp;<span class="keyword">mut</span> s)?;</span><br><span class="line">    <span class="literal">Ok</span>(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::fs;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">read_username_from_file</span></span>() -&gt; <span class="built_in">Result</span>&lt;<span class="built_in">String</span>, io::Error&gt; &#123;</span><br><span class="line">    fs::read_to_string(<span class="string">"hello.txt"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="9-2-5-The-Operator-Can-Only-Be-Used-in-Functions-That-Return-Result"><a href="#9-2-5-The-Operator-Can-Only-Be-Used-in-Functions-That-Return-Result" class="headerlink" title="9.2.5 The ? Operator Can Only Be Used in Functions That Return Result"></a>9.2.5 The <code>?</code> Operator Can Only Be Used in Functions That Return <code>Result</code></h4><p>Because it is defined to work in the same way as the <code>match</code> expression.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> f = File::open(<span class="string">"hello.txt"</span>)?; <span class="comment">// without mut, return ()</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">error[E0277]: the `?` operator can only be used in a function that returns</span></span><br><span class="line"><span class="string">`Result` or `Option` (or another type that implements `std::ops::Try`)</span></span><br><span class="line"><span class="string"> --&gt; src/main.rs:4:13</span></span><br><span class="line"><span class="string">  |</span></span><br><span class="line"><span class="string">4 |     let f = File::open("</span>hello.txt<span class="string">")?;</span></span><br><span class="line"><span class="string">  |             ^^^^^^^^^^^^^^^^^^^^^^^^ cannot use the `?` operator in a</span></span><br><span class="line"><span class="string">  function that returns `()`</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>
<p>However, we can change how we write the <code>main</code> function so that it does return a <code>Result&lt;T, E&gt;</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::error::Error;</span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; <span class="built_in">Result</span>&lt;(), <span class="built_in">Box</span>&lt;dyn Error&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> f = File::open(<span class="string">"hello.txt"</span>)?;</span><br><span class="line">    <span class="literal">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For now, you can read <code>Box&lt;dyn Error&gt;</code> to mean “any kind of error.”</p>
<h3 id="9-3-To-panic-or-Not-to-panic"><a href="#9-3-To-panic-or-Not-to-panic" class="headerlink" title="9.3 To panic! or Not to panic!"></a>9.3 To <code>panic!</code> or Not to <code>panic!</code></h3><p>When you choose to return a <code>Result</code> value, you give the calling code options rather than making the decision for it. The calling code could choose to attempt to recover in a way that’s appropriate for its situation, or it could decide that an <code>Err</code> value in this case is unrecoverable, so it can call <code>panic!</code> and turn your recoverable error into an unrecoverable one. <strong>Therefore, returning <code>Result</code> is a good default choice when you’re defining a function that might fail. In rare situations, it’s more appropriate to write code that panics instead of returning a <code>Result</code>.</strong></p>
<h4 id="9-3-1-Examples-Prototype-Code-and-Tests"><a href="#9-3-1-Examples-Prototype-Code-and-Tests" class="headerlink" title="9.3.1 Examples, Prototype Code, and Tests"></a>9.3.1 Examples, Prototype Code, and Tests</h4><p>If a method call fails in a test, you’d want the whole test to fail, even if that method isn’t the functionality under test. Because <code>panic!</code> is how a test is marked as a failure, calling <code>unwrap</code> or <code>expect</code> is exactly what should happen.</p>
<h4 id="9-3-2-Cases-in-Which-You-Have-More-Information-Than-the-Compiler"><a href="#9-3-2-Cases-in-Which-You-Have-More-Information-Than-the-Compiler" class="headerlink" title="9.3.2 Cases in Which You Have More Information Than the Compiler"></a>9.3.2 Cases in Which You Have More Information Than the Compiler</h4><p>It would also be appropriate to call <code>unwrap</code> when you have some other logic that ensures the <code>Result</code> will have an <code>Ok</code> value, but the logic isn’t something the compiler understands. You’ll still have a <code>Result</code> value that you need to handle: whatever operation you’re calling still has the possibility of failing in general, even though it’s logically impossible in your particular situation. If you can ensure by manually inspecting the code that you’ll never have an <code>Err</code> variant, it’s perfectly acceptable to call <code>unwrap</code>. Here’s an example:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::net::IpAddr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> home: IpAddr = <span class="string">"127.0.0.1"</span>.parse().unwrap();</span><br></pre></td></tr></table></figure>
<p>We’re creating an <code>IpAddr</code> instance by parsing a hardcoded string. We can see that <code>127.0.0.1</code> is a valid IP address, so it’s acceptable to use <code>unwrap</code> here. However, having a hardcoded, valid string doesn’t change the return type of the <code>parse</code> method: we still get a <code>Result</code> value, and the compiler will still make us handle the <code>Result</code> as if the <code>Err</code> variant is a possibility because the compiler isn’t smart enough to see that this string is always a valid IP address. If the IP address string came from a user rather than being hardcoded into the program and therefore <em>did</em> have a possibility of failure, we’d definitely want to handle the <code>Result</code> in a more robust way instead.</p>
<h4 id="9-3-3-Guidelines-for-Error-Handling"><a href="#9-3-3-Guidelines-for-Error-Handling" class="headerlink" title="9.3.3 Guidelines for Error Handling"></a>9.3.3 Guidelines for Error Handling</h4><p>It’s advisable to have your code panic when it’s possible that your code could end up in a bad state. In this context, a <em>bad state</em> is when some assumption, guarantee, contract, or invariant has been broken, such as when invalid values, contradictory values, or missing values are passed to your code—plus one or more of the following:</p>
<ul>
<li>The bad state is not something that’s <em>expected</em> to happen occasionally.</li>
<li>Your code after this point needs to rely on not being in this bad state.</li>
<li>There’s not a good way to encode this information in the types you use.</li>
</ul>
<p>If someone calls your code and passes in values that don’t make sense, the best choice might be to call <code>panic!</code> and alert the person using your library to the bug in their code so they can fix it during development. Similarly, <code>panic!</code> is often appropriate if you’re calling external code that is out of your control and it returns an invalid state that you have no way of fixing.</p>
<p>However, <strong>when failure is expected, it’s more appropriate to return a <code>Result</code> than to make a <code>panic!</code>call.</strong> Examples include a parser being given malformed data or an HTTP request returning a status that indicates you have hit a rate limit. In these cases, returning a <code>Result</code> indicates that failure is an expected possibility that the calling code must decide how to handle.</p>
<p>When your code performs operations on values, your code should verify the values are valid first and panic if the values aren’t valid. This is mostly for safety reasons: attempting to operate on invalid data can expose your code to vulnerabilities. This is the main reason the standard library will call <code>panic!</code> if you attempt an out-of-bounds memory access: trying to access memory that doesn’t belong to the current data structure is a common security problem. Functions often have <em>contracts</em>: their behavior is only guaranteed if the inputs meet particular requirements. Panicking when the contract is violated makes sense because a contract violation always indicates a caller-side bug and it’s not a kind of error you want the calling code to have to explicitly handle. In fact, there’s no reasonable way for calling code to recover; the calling <em>programmers</em> need to fix the code. Contracts for a function, especially when a violation will cause a panic, should be explained in the API documentation for the function.</p>
<p>However, having lots of error checks in all of your functions would be verbose and annoying. Fortunately, you can use Rust’s type system (and thus the type checking the compiler does) to do many of the checks for you. If your function has a particular type as a parameter, you can proceed with your code’s logic knowing that the compiler has already ensured you have a valid value. For example, if you have a type rather than an <code>Option</code>, your program expects to have <em>something</em> rather than <em>nothing</em>. Your code then doesn’t have to handle two cases for the <code>Some</code> and <code>None</code> variants: it will only have one case for definitely having a value. Code trying to pass nothing to your function won’t even compile, so your function doesn’t have to check for that case at runtime. Another example is using an unsigned integer type such as <code>u32</code>, which ensures the parameter is never negative.</p>
<h4 id="9-3-4-Creating-Custom-Types-for-Validation"><a href="#9-3-4-Creating-Custom-Types-for-Validation" class="headerlink" title="9.3.4 Creating Custom Types for Validation"></a>9.3.4 Creating Custom Types for Validation</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">loop</span> &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> guess: <span class="keyword">i32</span> = <span class="keyword">match</span> guess.trim().parse() &#123;</span><br><span class="line">        <span class="literal">Ok</span>(num) =&gt; num,</span><br><span class="line">        <span class="literal">Err</span>(_) =&gt; <span class="keyword">continue</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> guess &lt; <span class="number">1</span> || guess &gt; <span class="number">100</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"The secret number will be between 1 and 100."</span>);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> guess.cmp(&amp;secret_number) &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>However, this is not an ideal solution: if it was absolutely critical that the program only operated on values between 1 and 100, and it had many functions with this requirement, having a check like this in every function would be tedious (and might impact performance).</p>
<p>Instead, we can make a new type and put the validations in a function to create an instance of the type rather than repeating the validations everywhere. That way, it’s safe for functions to use the new type in their signatures and confidently use the values they receive. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Guess</span></span> &#123;</span><br><span class="line">    value: <span class="keyword">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Guess &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(value: <span class="keyword">i32</span>) -&gt; Guess &#123;</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">1</span> || value &gt; <span class="number">100</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">"Guess value must be between 1 and 100, got &#123;&#125;."</span>, value);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// private, can not be set, only create by new</span></span><br><span class="line">        Guess &#123;</span><br><span class="line">            value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">value</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="keyword">i32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>panic!</code> macro signals that your program is in a state it can’t handle and lets you tell the process to stop instead of trying to proceed with invalid or incorrect values. The <code>Result</code> enum uses Rust’s type system to indicate that operations might fail in a way that your code could recover from.</p>
<h2 id="10-Generic-Types-Traits-and-Lifetimes"><a href="#10-Generic-Types-Traits-and-Lifetimes" class="headerlink" title="10 Generic Types, Traits, and Lifetimes"></a>10 Generic Types, Traits, and Lifetimes</h2><p>Generics are abstract stand-ins for concrete types or other properties. </p>
<h3 id="10-1-Generic-Data-Types"><a href="#10-1-Generic-Data-Types" class="headerlink" title="10.1 Generic Data Types"></a>10.1 Generic Data Types</h3><h4 id="10-1-1-In-Function-Definitions"><a href="#10-1-1-In-Function-Definitions" class="headerlink" title="10.1.1 In Function Definitions"></a>10.1.1 In Function Definitions</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">largest_i32</span></span>(list: &amp;[<span class="keyword">i32</span>]) -&gt; <span class="keyword">i32</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> largest = list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list.iter() &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">largest_char</span></span>(list: &amp;[<span class="keyword">char</span>]) -&gt; <span class="keyword">char</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> largest = list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list.iter() &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">largest</span></span>&lt;T&gt;(list: &amp;[T]) -&gt; T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> largest = list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list.iter() &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-1-2-In-Struct-Definitions"><a href="#10-1-2-In-Struct-Definitions" class="headerlink" title="10.1.2 In Struct Definitions"></a>10.1.2 In Struct Definitions</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// x, y same type</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> integer = Point &#123; x: <span class="number">5</span>, y: <span class="number">10</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">float</span> = Point &#123; x: <span class="number">1.0</span>, y: <span class="number">4.0</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// x, y different type</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span>&lt;T, U&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: U,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> both_integer = Point &#123; x: <span class="number">5</span>, y: <span class="number">10</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> both_float = Point &#123; x: <span class="number">1.0</span>, y: <span class="number">4.0</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> integer_and_float = Point &#123; x: <span class="number">5</span>, y: <span class="number">4.0</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-1-3-In-Enum-Definitions"><a href="#10-1-3-In-Enum-Definitions" class="headerlink" title="10.1.3 In Enum Definitions"></a>10.1.3 In Enum Definitions</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Option</span></span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="literal">Some</span>(T),</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Result</span></span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="literal">Ok</span>(T),</span><br><span class="line">    <span class="literal">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-1-4-In-Method-Definitions"><a href="#10-1-4-In-Method-Definitions" class="headerlink" title="10.1.4 In Method Definitions"></a>10.1.4 In Method Definitions</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Point&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">x</span></span>(&amp;<span class="keyword">self</span>) -&gt; &amp;T &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// type Point&lt;f32&gt; will have a method named distance_from_origin and other instances of Point&lt;T&gt; where T is not of type f32 will not have this method defined. </span></span><br><span class="line"><span class="keyword">impl</span> Point&lt;<span class="keyword">f32</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">distance_from_origin</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="keyword">f32</span> &#123;</span><br><span class="line">        (<span class="keyword">self</span>.x.powi(<span class="number">2</span>) + <span class="keyword">self</span>.y.powi(<span class="number">2</span>)).sqrt()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> p = Point &#123; x: <span class="number">5</span>, y: <span class="number">10</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"p.x = &#123;&#125;"</span>, p.x());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Generic type parameters in a struct definition aren’t always the same as those you use in that struct’s method signatures.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span>&lt;T, U&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: U,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T, U&gt; Point&lt;T, U&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">mixup</span></span>&lt;V, W&gt;(<span class="keyword">self</span>, other: Point&lt;V, W&gt;) -&gt; Point&lt;T, W&gt; &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x: <span class="keyword">self</span>.x,</span><br><span class="line">            y: other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> p1 = Point &#123; x: <span class="number">5</span>, y: <span class="number">10.4</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> p2 = Point &#123; x: <span class="string">"Hello"</span>, y: <span class="string">'c'</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> p3 = p1.mixup(p2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"p3.x = &#123;&#125;, p3.y = &#123;&#125;"</span>, p3.x, p3.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here, the generic parameters <code>T</code> and <code>U</code> are declared after <code>impl</code>, because they go with the struct definition. The generic parameters <code>V</code> and <code>W</code> are declared after <code>fn mixup</code>, because they’re only relevant to the method.</p>
<h4 id="10-1-5-Performance-of-Code-Using-Generics"><a href="#10-1-5-Performance-of-Code-Using-Generics" class="headerlink" title="10.1.5 Performance of Code Using Generics"></a>10.1.5 Performance of Code Using Generics</h4><p>Rust accomplishes this by performing monomorphization of the code that is using generics at compile time. <em>Monomorphization</em> is the process of turning generic code into specific code by filling in the concrete types that are used when compiled.</p>
<p>The monomorphized version of the code looks like the following. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Option_i32</span></span> &#123;</span><br><span class="line">    <span class="literal">Some</span>(<span class="keyword">i32</span>),</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Option_f64</span></span> &#123;</span><br><span class="line">    <span class="literal">Some</span>(<span class="keyword">f64</span>),</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> integer = Option_i32::<span class="literal">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">float</span> = Option_f64::<span class="literal">Some</span>(<span class="number">5.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Because Rust compiles generic code into code that specifies the type in each instance, we pay no runtime cost for using generics. When the code runs, it performs just as it would if we had duplicated each definition by hand. The process of monomorphization makes Rust’s generics extremely efficient at runtime.</p>
<h3 id="10-2-Traits-Defining-Shared-Behavior"><a href="#10-2-Traits-Defining-Shared-Behavior" class="headerlink" title="10.2 Traits: Defining Shared Behavior"></a>10.2 Traits: Defining Shared Behavior</h3><p>A <em>trait</em> tells the Rust compiler about functionality a particular type has and can share with other types. We can use traits to define shared behavior in an abstract way. We can use trait bounds to specify that a generic can be any type that has certain behavior.</p>
<h4 id="10-2-1-Defining-a-Trait"><a href="#10-2-1-Defining-a-Trait" class="headerlink" title="10.2.1 Defining a Trait"></a>10.2.1 Defining a Trait</h4><p>Trait definitions are a way to group method signatures together to define a set of behaviors necessary to accomplish some purpose.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Summary</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">summarize</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A trait can have multiple methods in its body: the method signatures are listed one per line and each line ends in a semicolon.</p>
<h4 id="10-2-2-Implementing-a-Trait-on-a-Type"><a href="#10-2-2-Implementing-a-Trait-on-a-Type" class="headerlink" title="10.2.2 Implementing a Trait on a Type"></a>10.2.2 Implementing a Trait on a Type</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">NewsArticle</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> headline: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> location: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> author: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Summary <span class="keyword">for</span> NewsArticle &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">summarize</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">"&#123;&#125;, by &#123;&#125; (&#123;&#125;)"</span>, <span class="keyword">self</span>.headline, <span class="keyword">self</span>.author, <span class="keyword">self</span>.location)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Tweet</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> username: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> reply: <span class="keyword">bool</span>,</span><br><span class="line">    <span class="keyword">pub</span> retweet: <span class="keyword">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Summary <span class="keyword">for</span> Tweet &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">summarize</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">"&#123;&#125;: &#123;&#125;"</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>After implementing the trait, we can call the methods on instances of <code>NewsArticle</code> and <code>Tweet</code> in the same way we call regular methods, like this:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> tweet = Tweet &#123;</span><br><span class="line">    username: <span class="built_in">String</span>::from(<span class="string">"horse_ebooks"</span>),</span><br><span class="line">    content: <span class="built_in">String</span>::from(<span class="string">"of course, as you probably already know, people"</span>),</span><br><span class="line">    reply: <span class="literal">false</span>,</span><br><span class="line">    retweet: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">"1 new tweet: &#123;&#125;"</span>, tweet.summarize());</span><br></pre></td></tr></table></figure>
<p><code>use aggregator::Summary;</code> would enable them to implement <code>Summary</code> for their type. The <code>Summary</code> trait would also need to be a public trait for another crate to implement it.</p>
<p>One restriction to note with trait implementations is that we can implement a trait on a type only if either the trait or the type is local to our crate. For example, we can implement standard library traits like <code>Display</code> on a custom type like <code>Tweet</code> as part of our <code>aggregator</code> crate functionality, because the type <code>Tweet</code> is local to our <code>aggregator</code> crate. We can also implement <code>Summary</code> on <code>Vec&lt;T&gt;</code> in our <code>aggregator</code> crate, because the trait <code>Summary</code> is local to our <code>aggregator</code> crate.</p>
<p>But we can’t implement external traits on external types. For example, we can’t implement the <code>Display</code> trait on <code>Vec&lt;T&gt;</code> within our <code>aggregator</code> crate, because <code>Display</code> and <code>Vec&lt;T&gt;</code> are defined in the standard library and aren’t local to our <code>aggregator</code> crate. This restriction is part of a property of programs called <em>coherence</em>, and more specifically the <em>orphan rule</em>, so named because the parent type is not present. This rule ensures that other people’s code can’t break your code and vice versa. Without the rule, two crates could implement the same trait for the same type, and Rust wouldn’t know which implementation to use.</p>
<h4 id="10-2-3-Default-Implementations"><a href="#10-2-3-Default-Implementations" class="headerlink" title="10.2.3 Default Implementations"></a>10.2.3 Default Implementations</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Summary</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">summarize</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">        <span class="built_in">String</span>::from(<span class="string">"(Read more...)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Summary</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">summarize_author</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">summarize</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">"(Read more from &#123;&#125;...)"</span>, <span class="keyword">self</span>.summarize_author())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To use this version of <code>Summary</code>, we only need to define <code>summarize_author</code> when we implement the trait on a type:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Summary <span class="keyword">for</span> Tweet &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">summarize_author</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">"@&#123;&#125;"</span>, <span class="keyword">self</span>.username)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that it isn’t possible to call the default implementation from an overriding implementation of that same method.</p>
<h4 id="10-2-4-Traits-as-Parameters"><a href="#10-2-4-Traits-as-Parameters" class="headerlink" title="10.2.4 Traits as Parameters"></a>10.2.4 Traits as Parameters</h4><p>We can define a function <code>notify</code> that calls the <code>summarize</code> method on its parameter <code>item</code>, which is of some type that implements the <code>Summary</code> trait. To do this, we can use the <code>impl Trait</code>syntax, like this:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>(item: <span class="keyword">impl</span> Summary) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Breaking news! &#123;&#125;"</span>, item.summarize());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="10-2-4-1-Trait-Bound-Syntax"><a href="#10-2-4-1-Trait-Bound-Syntax" class="headerlink" title="10.2.4.1 Trait Bound Syntax"></a>10.2.4.1 Trait Bound Syntax</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>&lt;T: Summary&gt;(item: T) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Breaking news! &#123;&#125;"</span>, item.summarize());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is equivalent to the example above, but is a bit more verbose.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// have two parameters that implement Summary</span></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>(item1: <span class="keyword">impl</span> Summary, item2: <span class="keyword">impl</span> Summary) &#123;&#125;</span><br><span class="line"><span class="comment">// force both parameters to have the exact same type</span></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>&lt;T: Summary&gt;(item1: T, item2: T) &#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="10-2-4-2-Specifying-Multiple-Trait-Bounds-with-Syntax"><a href="#10-2-4-2-Specifying-Multiple-Trait-Bounds-with-Syntax" class="headerlink" title="10.2.4.2 Specifying Multiple Trait Bounds with + Syntax"></a>10.2.4.2 Specifying Multiple Trait Bounds with <code>+</code> Syntax</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>(item: <span class="keyword">impl</span> Summary + Display) &#123;&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">notify</span></span>&lt;T: Summary + Display&gt;(item: T) &#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="10-2-4-3-Clearer-Trait-Bounds-with-where-Clauses"><a href="#10-2-4-3-Clearer-Trait-Bounds-with-where-Clauses" class="headerlink" title="10.2.4.3 Clearer Trait Bounds with where Clauses"></a>10.2.4.3 Clearer Trait Bounds with <code>where</code> Clauses</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">some_function</span></span>&lt;T: Display + <span class="built_in">Clone</span>, U: <span class="built_in">Clone</span> + Debug&gt;(t: T, u: U) -&gt; <span class="keyword">i32</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">some_function</span></span>&lt;T, U&gt;(t: T, u: U) -&gt; <span class="keyword">i32</span></span><br><span class="line">    <span class="keyword">where</span> T: Display + <span class="built_in">Clone</span>,</span><br><span class="line">          U: <span class="built_in">Clone</span> + Debug</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-2-5-Returning-Types-that-Implement-Traits"><a href="#10-2-5-Returning-Types-that-Implement-Traits" class="headerlink" title="10.2.5 Returning Types that Implement Traits"></a>10.2.5 Returning Types that Implement Traits</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">returns_summarizable</span></span>() -&gt; <span class="keyword">impl</span> Summary &#123;</span><br><span class="line">    Tweet &#123;</span><br><span class="line">        username: <span class="built_in">String</span>::from(<span class="string">"horse_ebooks"</span>),</span><br><span class="line">        content: <span class="built_in">String</span>::from(<span class="string">"of course, as you probably already know, people"</span>),</span><br><span class="line">        reply: <span class="literal">false</span>,</span><br><span class="line">        retweet: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>returns_summarizable</code> returns a <code>Tweet</code>, but the code calling this function doesn’t know that. </p>
<p>Using <code>impl Trait</code> is only allowed if you have a single type that you’re returning. </p>
<h4 id="10-2-6-Fixing-the-largest-Function-with-Trait-Bounds"><a href="#10-2-6-Fixing-the-largest-Function-with-Trait-Bounds" class="headerlink" title="10.2.6 Fixing the largest Function with Trait Bounds"></a>10.2.6 Fixing the <code>largest</code> Function with Trait Bounds</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">largest</span></span>&lt;T: <span class="built_in">PartialOrd</span>&gt;(list: &amp;[T]) -&gt; T &#123;&#125;</span><br><span class="line"><span class="comment">// error[E0508]: cannot move out of type `[T]`, a non-copy slice</span></span><br></pre></td></tr></table></figure>
<p>types like <code>i32</code> and <code>char</code> that have a known size can be stored on the stack, so they implement the <code>Copy</code> trait. But when we made the <code>largest</code> function generic, it became possible for the <code>list</code> parameter to have types in it that don’t implement the <code>Copy</code> trait. Consequently, we wouldn’t be able to move the value out of <code>list[0]</code> and into the <code>largest</code> variable, resulting in this error.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">largest</span></span>&lt;T: <span class="built_in">PartialOrd</span> + <span class="built_in">Copy</span>&gt;(list: &amp;[T]) -&gt; T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> largest = list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list.iter() &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> number_list = <span class="built_in">vec!</span>[<span class="number">34</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">65</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = largest(&amp;number_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"The largest number is &#123;&#125;"</span>, result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> char_list = <span class="built_in">vec!</span>[<span class="string">'y'</span>, <span class="string">'m'</span>, <span class="string">'a'</span>, <span class="string">'q'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = largest(&amp;char_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"The largest char is &#123;&#125;"</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If we don’t want to restrict the <code>largest</code> function to the types that implement the <code>Copy</code> trait, we could specify that <code>T</code> has the trait bound <code>Clone</code> instead of <code>Copy</code>. Then we could clone each value in the slice when we want the <code>largest</code> function to have ownership. Using the <code>clone</code> function means we’re potentially making more heap allocations in the case of types that own heap data like <code>String</code>, and heap allocations can be slow if we’re working with large amounts of data.</p>
<p>Another way we could implement <code>largest</code> is for the function to return a reference to a <code>T</code> value in the slice. If we change the return type to <code>&amp;T</code> instead of <code>T</code>, thereby changing the body of the function to return a reference, we wouldn’t need the <code>Clone</code> or <code>Copy</code> trait bounds and we could avoid heap allocations.</p>
<h4 id="10-2-7-Using-Trait-Bounds-to-Conditionally-Implement-Methods"><a href="#10-2-7-Using-Trait-Bounds-to-Conditionally-Implement-Methods" class="headerlink" title="10.2.7 Using Trait Bounds to Conditionally Implement Methods"></a>10.2.7 Using Trait Bounds to Conditionally Implement Methods</h4><p>By using a trait bound with an <code>impl</code> block that uses generic type parameters, we can implement methods conditionally for types that implement the specified traits. For example, the type <code>Pair&lt;T&gt;</code>always implements the <code>new</code> function. But <code>Pair&lt;T&gt;</code> only implements the <code>cmp_display</code> method if its inner type <code>T</code> implements the <code>PartialOrd</code> trait that enables comparison <em>and</em> the <code>Display</code> trait that enables printing.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pair</span></span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Pair&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(x: T, y: T) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            x,</span><br><span class="line">            y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: Display + <span class="built_in">PartialOrd</span>&gt; Pair&lt;T&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">cmp_display</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.x &gt;= <span class="keyword">self</span>.y &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"The largest member is x = &#123;&#125;"</span>, <span class="keyword">self</span>.x);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"The largest member is y = &#123;&#125;"</span>, <span class="keyword">self</span>.y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can also conditionally implement a trait for any type that implements another trait. Implementations of a trait on any type that satisfies the trait bounds are called <em>blanket implementations</em> and are extensively used in the Rust standard library. For example, the standard library implements the <code>ToString</code> trait on any type that implements the <code>Display</code> trait. The <code>impl</code>block in the standard library looks similar to this code:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T: Display&gt; <span class="built_in">ToString</span> <span class="keyword">for</span> T &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Because the standard library has this blanket implementation, we can call the to_string method defined by the ToString trait on any type that implements the Display trait. For example, we can turn integers into their corresponding String values like this because integers implement Display:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="number">3</span>.to_string();</span><br></pre></td></tr></table></figure>
<h3 id="10-3-Validating-References-with-Lifetimes"><a href="#10-3-Validating-References-with-Lifetimes" class="headerlink" title="10.3 Validating References with Lifetimes"></a>10.3 Validating References with Lifetimes</h3><h4 id="10-3-1-Preventing-Dangling-References-with-Lifetimes"><a href="#10-3-1-Preventing-Dangling-References-with-Lifetimes" class="headerlink" title="10.3.1 Preventing Dangling References with Lifetimes"></a>10.3.1 Preventing Dangling References with Lifetimes</h4><p>x out of scope doesn’t live long enough.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> r;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> x = <span class="number">5</span>;</span><br><span class="line">        r = &amp;x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"r: &#123;&#125;"</span>, r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This code won’t compile because the value <code>r</code> is referring to has gone out of scope before we try to use it. </p>
<h4 id="10-3-2-The-Borrow-Checker"><a href="#10-3-2-The-Borrow-Checker" class="headerlink" title="10.3.2 The Borrow Checker"></a>10.3.2 The Borrow Checker</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="number">5</span>;            <span class="comment">// ----------+-- 'b</span></span><br><span class="line">                          <span class="comment">//           |</span></span><br><span class="line">    <span class="keyword">let</span> r = &amp;x;           <span class="comment">// --+-- 'a  |</span></span><br><span class="line">                          <span class="comment">//   |       |</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"r: &#123;&#125;"</span>, r); <span class="comment">//   |       |</span></span><br><span class="line">                          <span class="comment">// --+       |</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here, <code>x</code> has the lifetime <code>&#39;b</code>, which in this case is larger than <code>&#39;a</code>. This means <code>r</code> can reference <code>x</code>because Rust knows that the reference in <code>r</code> will always be valid while <code>x</code> is valid.</p>
<h4 id="10-3-3-Generic-Lifetimes-in-Functions"><a href="#10-3-3-Generic-Lifetimes-in-Functions" class="headerlink" title="10.3.3 Generic Lifetimes in Functions"></a>10.3.3 Generic Lifetimes in Functions</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">longest</span></span>(x: &amp;<span class="keyword">str</span>, y: &amp;<span class="keyword">str</span>) -&gt; &amp;<span class="keyword">str</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x.len() &gt; y.len() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> string1 = <span class="built_in">String</span>::from(<span class="string">"abcd"</span>);</span><br><span class="line">    <span class="keyword">let</span> string2 = <span class="string">"xyz"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = longest(string1.as_str(), string2);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"The longest string is &#123;&#125;"</span>, result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// error: missing lifetime specifier</span></span><br></pre></td></tr></table></figure>
<p>When we’re defining this function, we don’t know the concrete values that will be passed into this function, so we don’t know whether the <code>if</code> case or the <code>else</code> case will execute. We also don’t know the concrete lifetimes of the references that will be passed in, so we can’t look at the scopes to determine whether the reference we return will always be valid. </p>
<h4 id="10-3-4-Lifetime-Annotation-Syntax"><a href="#10-3-4-Lifetime-Annotation-Syntax" class="headerlink" title="10.3.4 Lifetime Annotation Syntax"></a>10.3.4 Lifetime Annotation Syntax</h4><p>Lifetime annotations don’t change how long any of the references live. Just as functions can accept any type when the signature specifies a generic type parameter, functions can accept references with any lifetime by specifying a generic lifetime parameter. Lifetime annotations describe the relationships of the lifetimes of multiple references to each other without affecting the lifetimes.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="keyword">i32</span>        <span class="comment">// a reference</span></span><br><span class="line">&amp;<span class="symbol">'a</span> <span class="keyword">i32</span>     <span class="comment">// a reference with an explicit lifetime</span></span><br><span class="line">&amp;<span class="symbol">'a</span> <span class="keyword">mut</span> <span class="keyword">i32</span> <span class="comment">// a mutable reference with an explicit lifetime</span></span><br></pre></td></tr></table></figure>
<h4 id="10-3-5-Lifetime-Annotations-in-Function-Signatures"><a href="#10-3-5-Lifetime-Annotations-in-Function-Signatures" class="headerlink" title="10.3.5 Lifetime Annotations in Function Signatures"></a>10.3.5 Lifetime Annotations in Function Signatures</h4><p>All the references in the parameters and the return value must have the same lifetime. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">longest</span></span>&lt;<span class="symbol">'a</span>&gt;(x: &amp;<span class="symbol">'a</span> <span class="keyword">str</span>, y: &amp;<span class="symbol">'a</span> <span class="keyword">str</span>) -&gt; &amp;<span class="symbol">'a</span> <span class="keyword">str</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x.len() &gt; y.len() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Remember, when we specify the lifetime parameters in this function signature, we’re not changing the lifetimes of any values passed in or returned. Rather, we’re specifying that the borrow checker should reject any values that don’t adhere to these constraints. Note that the <code>longest</code> function doesn’t need to know exactly how long <code>x</code> and <code>y</code> will live, only that some scope can be substituted for <code>&#39;a</code> that will satisfy this signature.</p>
<h4 id="10-3-6-Thinking-in-Terms-of-Lifetimes"><a href="#10-3-6-Thinking-in-Terms-of-Lifetimes" class="headerlink" title="10.3.6 Thinking in Terms of Lifetimes"></a>10.3.6 Thinking in Terms of Lifetimes</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">longest</span></span>&lt;<span class="symbol">'a</span>&gt;(x: &amp;<span class="keyword">str</span>, y: &amp;<span class="keyword">str</span>) -&gt; &amp;<span class="symbol">'a</span> <span class="keyword">str</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="built_in">String</span>::from(<span class="string">"really long string"</span>);</span><br><span class="line">    result.as_str()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// error[E0597]: `result` does not live long enough</span></span><br></pre></td></tr></table></figure>
<p>The problem is that <code>result</code> goes out of scope and gets cleaned up at the end of the <code>longest</code> function. We’re also trying to return a reference to <code>result</code> from the function. </p>
<h4 id="10-3-7-Lifetime-Annotations-in-Struct-Definitions"><a href="#10-3-7-Lifetime-Annotations-in-Struct-Definitions" class="headerlink" title="10.3.7 Lifetime Annotations in Struct Definitions"></a>10.3.7 Lifetime Annotations in Struct Definitions</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ImportantExcerpt</span></span>&lt;<span class="symbol">'a</span>&gt; &#123;</span><br><span class="line">    part: &amp;<span class="symbol">'a</span> <span class="keyword">str</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// This annotation means an instance of ImportantExcerpt can’t outlive the reference it holds in its part field.</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> novel = <span class="built_in">String</span>::from(<span class="string">"Call me Ishmael. Some years ago..."</span>);</span><br><span class="line">    <span class="keyword">let</span> first_sentence = novel.split(<span class="string">'.'</span>)</span><br><span class="line">        .next()</span><br><span class="line">        .expect(<span class="string">"Could not find a '.'"</span>);</span><br><span class="line">    <span class="keyword">let</span> i = ImportantExcerpt &#123; part: first_sentence &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-3-8-Lifetime-Elision"><a href="#10-3-8-Lifetime-Elision" class="headerlink" title="10.3.8 Lifetime Elision"></a>10.3.8 Lifetime Elision</h4><p>Lifetimes on function or method parameters are called <em>input lifetimes</em>, and lifetimes on return values are called <em>output lifetimes</em>.</p>
<p>The compiler uses three rules to figure out what lifetimes references have when there aren’t explicit annotations. The first rule applies to input lifetimes, and the second and third rules apply to output lifetimes. If the compiler gets to the end of the three rules and there are still references for which it can’t figure out lifetimes, the compiler will stop with an error. These rules apply to <code>fn</code> definitions as well as <code>impl</code> blocks.</p>
<ul>
<li>The first rule is that each parameter that is a reference gets its own lifetime parameter.</li>
<li>The second rule is if there is exactly one input lifetime parameter, that lifetime is assigned to all output lifetime parameters.</li>
<li>The third rule is if there are multiple input lifetime parameters, but one of them is <code>&amp;self</code> or <code>&amp;mut self</code> because this is a method, the lifetime of <code>self</code> is assigned to all output lifetime parameters. </li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">longest</span></span>(x: &amp;<span class="keyword">str</span>, y: &amp;<span class="keyword">str</span>) -&gt; &amp;<span class="keyword">str</span> &#123;</span><br><span class="line"><span class="comment">// Let’s apply the first rule: each parameter gets its own lifetime. This time we have two parameters instead of one, so we have two lifetimes:</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">longest</span></span>&lt;<span class="symbol">'a</span>, <span class="symbol">'b</span>&gt;(x: &amp;<span class="symbol">'a</span> <span class="keyword">str</span>, y: &amp;<span class="symbol">'b</span> <span class="keyword">str</span>) -&gt; &amp;<span class="keyword">str</span> &#123;</span><br></pre></td></tr></table></figure>
<p>You can see that the second rule doesn’t apply because there is more than one input lifetime. The third rule doesn’t apply either, because longest is a function rather than a method, so none of the parameters are self. After working through all three rules, we still haven’t figured out what the return type’s lifetime is. This is why we got an error trying to compile the code above.</p>
<h4 id="10-3-9-Lifetime-Annotations-in-Method-Definitions"><a href="#10-3-9-Lifetime-Annotations-in-Method-Definitions" class="headerlink" title="10.3.9 Lifetime Annotations in Method Definitions"></a>10.3.9 Lifetime Annotations in Method Definitions</h4><p>Lifetime names for struct fields always need to be declared after the <code>impl</code> keyword and then used after the struct’s name, because those lifetimes are part of the struct’s type.</p>
<p>In method signatures inside the <code>impl</code> block, references might be tied to the lifetime of references in the struct’s fields, or they might be independent. In addition, the lifetime elision rules often make it so that lifetime annotations aren’t necessary in method signatures. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">'a</span>&gt; ImportantExcerpt&lt;<span class="symbol">'a</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">level</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="keyword">i32</span> &#123;</span><br><span class="line">        <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The lifetime parameter declaration after <code>impl</code> and use after the type name is required, but we’re not required to annotate the lifetime of the reference to <code>self</code> because of the first elision rule.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">'a</span>&gt; ImportantExcerpt&lt;<span class="symbol">'a</span>&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">announce_and_return_part</span></span>(&amp;<span class="keyword">self</span>, announcement: &amp;<span class="keyword">str</span>) -&gt; &amp;<span class="keyword">str</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Attention please: &#123;&#125;"</span>, announcement);</span><br><span class="line">        <span class="keyword">self</span>.part</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There are two input lifetimes, so Rust applies the first lifetime elision rule and gives both <code>&amp;self</code> and <code>announcement</code> their own lifetimes. Then, because one of the parameters is <code>&amp;self</code>, the return type gets the lifetime of <code>&amp;self</code>, and all lifetimes have been accounted for.</p>
<h4 id="10-3-10-The-Static-Lifetime"><a href="#10-3-10-The-Static-Lifetime" class="headerlink" title="10.3.10 The Static Lifetime"></a>10.3.10 The Static Lifetime</h4><p><code>let s: &amp;&#39;static str = &quot;I have a static lifetime.&quot;;</code></p>
<p>The text of this string is stored directly in the binary of your program, which is always available. Therefore, the lifetime of all string literals is <code>&#39;static</code>.</p>
<h3 id="10-4-Generic-Type-Parameters-Trait-Bounds-and-Lifetimes-Together"><a href="#10-4-Generic-Type-Parameters-Trait-Bounds-and-Lifetimes-Together" class="headerlink" title="10.4 Generic Type Parameters, Trait Bounds, and Lifetimes Together"></a>10.4 Generic Type Parameters, Trait Bounds, and Lifetimes Together</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">longest_with_an_announcement</span></span>&lt;<span class="symbol">'a</span>, T&gt;(x: &amp;<span class="symbol">'a</span> <span class="keyword">str</span>, y: &amp;<span class="symbol">'a</span> <span class="keyword">str</span>, ann: T) -&gt; &amp;<span class="symbol">'a</span> <span class="keyword">str</span></span><br><span class="line">    <span class="keyword">where</span> T: Display</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Announcement! &#123;&#125;"</span>, ann);</span><br><span class="line">    <span class="keyword">if</span> x.len() &gt; y.len() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is the <code>longest</code> function from Listing 10-22 that returns the longer of two string slices. But now it has an extra parameter named <code>ann</code> of the generic type <code>T</code>, which can be filled in by any type that implements the <code>Display</code> trait as specified by the <code>where</code> clause. This extra parameter will be printed before the function compares the lengths of the string slices, which is why the <code>Display</code> trait bound is necessary. Because lifetimes are a type of generic, the declarations of the lifetime parameter <code>&#39;a</code>and the generic type parameter <code>T</code> go in the same list inside the angle brackets after the function name.</p>
<p>Generic type parameters let you apply the code to different types. Traits and trait bounds ensure that even though the types are generic, they’ll have the behavior the code needs. </p>
<h2 id="11-Writing-Automated-Tests"><a href="#11-Writing-Automated-Tests" class="headerlink" title="11 Writing Automated Tests"></a>11 Writing Automated Tests</h2><h3 id="11-1-How-to-Write-Tests"><a href="#11-1-How-to-Write-Tests" class="headerlink" title="11.1 How to Write Tests"></a>11.1 How to Write Tests</h3><ul>
<li>Set up needed data or state</li>
<li>Run test code</li>
<li>Assert results are what you expect</li>
</ul>
<h4 id="11-1-1-The-Anatomy-of-a-Test-Function"><a href="#11-1-1-The-Anatomy-of-a-Test-Function" class="headerlink" title="11.1.1 The Anatomy of a Test Function"></a>11.1.1 The Anatomy of a Test Function</h4><p>At its simplest, a test in Rust is a function that’s annotated with the <code>test</code> attribute. Attributes are metadata about pieces of Rust code. To change a function into a test function, add <code>#[test]</code> on the line before <code>fn</code>.</p>
<p>When we make a new library project with Cargo, a test module with a test function in it is automatically generated for us.</p>
<h4 id="11-1-2-Checking-Results-with-the-assert-Macro"><a href="#11-1-2-Checking-Results-with-the-assert-Macro" class="headerlink" title="11.1.2 Checking Results with the assert! Macro"></a>11.1.2 Checking Results with the <code>assert!</code> Macro</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;&#125;</span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rectangle</span></span> &#123;</span><br><span class="line">    width: <span class="keyword">u32</span>,</span><br><span class="line">    height: <span class="keyword">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Rectangle &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">can_hold</span></span>(&amp;<span class="keyword">self</span>, other: &amp;Rectangle) -&gt; <span class="keyword">bool</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.width &gt; other.width &amp;&amp; <span class="keyword">self</span>.height &gt; other.height</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="comment">// Because the tests module is an inner module, we need to bring the code under test in the outer module into the scope of the inner module. </span></span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">larger_can_hold_smaller</span></span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> larger = Rectangle &#123; width: <span class="number">8</span>, height: <span class="number">7</span> &#125;;</span><br><span class="line">        <span class="keyword">let</span> smaller = Rectangle &#123; width: <span class="number">5</span>, height: <span class="number">1</span> &#125;;</span><br><span class="line">        <span class="built_in">assert!</span>(larger.can_hold(&amp;smaller));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="11-1-3-Testing-Equality-with-the-assert-eq-and-assert-ne-Macros"><a href="#11-1-3-Testing-Equality-with-the-assert-eq-and-assert-ne-Macros" class="headerlink" title="11.1.3 Testing Equality with the assert_eq! and assert_ne! Macros"></a>11.1.3 Testing Equality with the <code>assert_eq!</code> and <code>assert_ne!</code> Macros</h4><p>The <code>assert_ne!</code> macro will pass if the two values we give it are not equal and fail if they’re equal. This macro is most useful for cases when we’re not sure what a value <em>will</em> be, but we know what the value definitely <em>won’t</em> be if our code is functioning as we intend.</p>
<p>Under the surface, the <code>assert_eq!</code> and <code>assert_ne!</code> macros use the operators <code>==</code> and <code>!=</code>, respectively. When the assertions fail, these macros print their arguments using debug formatting, which means the values being compared must implement the <code>PartialEq</code> and <code>Debug</code> traits. </p>
<ul>
<li>For structs and enums that you define, you’ll need to implement <code>PartialEq</code> to assert that values of those types are equal or not equal. </li>
<li>You’ll need to implement <code>Debug</code> to print the values when the assertion fails.</li>
</ul>
<h4 id="Adding-Custom-Failure-Messages"><a href="#Adding-Custom-Failure-Messages" class="headerlink" title="Adding Custom Failure Messages"></a>Adding Custom Failure Messages</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">greeting</span></span>(name: &amp;<span class="keyword">str</span>) -&gt; <span class="built_in">String</span> &#123;</span><br><span class="line">    <span class="built_in">format!</span>(<span class="string">"Hello &#123;&#125;!"</span>, name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">greeting_contains_name</span></span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> result = greeting(<span class="string">"Carol"</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(</span><br><span class="line">        result.contains(<span class="string">"Carol"</span>),</span><br><span class="line">        <span class="string">"Greeting did not contain name, value was `&#123;&#125;`"</span>, result</span><br><span class="line">    );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="11-1-5-Checking-for-Panics-with-should-panic"><a href="#11-1-5-Checking-for-Panics-with-should-panic" class="headerlink" title="11.1.5 Checking for Panics with should_panic"></a>11.1.5 Checking for Panics with <code>should_panic</code></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Guess</span></span> &#123;</span><br><span class="line">    value: <span class="keyword">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Guess &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(value: <span class="keyword">i32</span>) -&gt; Guess &#123;</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">1</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">"Guess value must be greatr than or equal to 1, got &#123;&#125;."</span>, value);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> value &gt; <span class="number">100</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">"Guess value must be less than or equal to 100, got &#123;&#125;."</span>, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Guess &#123;</span><br><span class="line">            value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="meta">#[should_panic(expected = <span class="meta-string">"Guess value must be less than or equal to 100"</span>)]</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">greater_than_100</span></span>() &#123;</span><br><span class="line">        Guess::new(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="11-1-6-Using-Result-lt-T-E-gt-in-Tests"><a href="#11-1-6-Using-Result-lt-T-E-gt-in-Tests" class="headerlink" title="11.1.6 Using Result&lt;T, E&gt; in Tests"></a>11.1.6 Using <code>Result&lt;T, E&gt;</code> in Tests</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">it_works</span></span>() -&gt; <span class="built_in">Result</span>&lt;(), <span class="built_in">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="number">2</span> + <span class="number">2</span> == <span class="number">4</span> &#123;</span><br><span class="line">            <span class="literal">Ok</span>(())</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">Err</span>(<span class="built_in">String</span>::from(<span class="string">"two plus two does not equal four"</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-2-Controlling-How-Tests-Are-Run"><a href="#11-2-Controlling-How-Tests-Are-Run" class="headerlink" title="11.2 Controlling How Tests Are Run"></a>11.2 Controlling How Tests Are Run</h3><h4 id="11-2-1-Running-Tests-in-Parallel-or-Consecutively"><a href="#11-2-1-Running-Tests-in-Parallel-or-Consecutively" class="headerlink" title="11.2.1 Running Tests in Parallel or Consecutively"></a>11.2.1 Running Tests in Parallel or Consecutively</h4><p>If you don’t want to run the tests in parallel or if you want more fine-grained control over the number of threads used: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span> -- --test-threads=1</span><br></pre></td></tr></table></figure>
<h4 id="11-2-2-Showing-Function-Output"><a href="#11-2-2-Showing-Function-Output" class="headerlink" title="11.2.2 Showing Function Output"></a>11.2.2 Showing Function Output</h4><p>If we want to see printed values for passing tests as well:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span> -- --nocapture</span><br></pre></td></tr></table></figure>
<h4 id="11-2-3-Running-a-Subset-of-Tests-by-Name"><a href="#11-2-3-Running-a-Subset-of-Tests-by-Name" class="headerlink" title="11.2.3 Running a Subset of Tests by Name"></a>11.2.3 Running a Subset of Tests by Name</h4><ul>
<li>Running single tests: <code>cargo test func_name</code></li>
<li>Filtering to run multiple tests: <code>cargo test some</code> will run functions whose name contains <code>some</code></li>
</ul>
<h4 id="11-2-4-Ignoring-Some-Tests-Unless-Specifically-Requested"><a href="#11-2-4-Ignoring-Some-Tests-Unless-Specifically-Requested" class="headerlink" title="11.2.4 Ignoring Some Tests Unless Specifically Requested"></a>11.2.4 Ignoring Some Tests Unless Specifically Requested</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="meta">#[ignore]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">expensive_test</span></span>() &#123;</span><br><span class="line">    <span class="comment">// code that takes an hour to run</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> If we want to run only the ignored tests:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span> -- --ignored</span><br></pre></td></tr></table></figure>
<h3 id="11-3-Test-Organization"><a href="#11-3-Test-Organization" class="headerlink" title="11.3 Test Organization"></a>11.3 Test Organization</h3><p>The Rust community thinks about tests in terms of two main categories: <em>unit tests</em> and <em>integration tests</em>.</p>
<p>Writing both kinds of tests is important to ensure that the pieces of your library are doing what you expect them to, separately and together.</p>
<h4 id="11-3-1-Unit-Tests"><a href="#11-3-1-Unit-Tests" class="headerlink" title="11.3.1 Unit Tests"></a>11.3.1 Unit Tests</h4><h5 id="11-3-1-1-The-Tests-Module-and-cfg-test"><a href="#11-3-1-1-The-Tests-Module-and-cfg-test" class="headerlink" title="11.3.1.1 The Tests Module and #[cfg(test)]"></a>11.3.1.1 The Tests Module and <code>#[cfg(test)]</code></h5><p>The <code>#[cfg(test)]</code> annotation on the tests module tells Rust to compile and run the test code only when you run <code>cargo test</code>, not when you run <code>cargo build</code>. </p>
<h5 id="11-3-1-2-Testing-Private-Functions"><a href="#11-3-1-2-Testing-Private-Functions" class="headerlink" title="11.3.1.2 Testing Private Functions"></a>11.3.1.2 Testing Private Functions</h5><p>Rust’s privacy rules do allow you to test private functions:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">add_two</span></span>(a: <span class="keyword">i32</span>) -&gt; <span class="keyword">i32</span> &#123;</span><br><span class="line">    internal_adder(a, <span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">internal_adder</span></span>(a: <span class="keyword">i32</span>, b: <span class="keyword">i32</span>) -&gt; <span class="keyword">i32</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">internal</span></span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="number">4</span>, internal_adder(<span class="number">2</span>, <span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="11-3-2-Integration-Tests"><a href="#11-3-2-Integration-Tests" class="headerlink" title="11.3.2 Integration Tests"></a>11.3.2 Integration Tests</h4><h5 id="11-3-2-1-The-tests-Directory"><a href="#11-3-2-1-The-tests-Directory" class="headerlink" title="11.3.2.1 The tests Directory"></a>11.3.2.1 The tests Directory</h5><p>We create a <em>tests</em> directory at the top level of our project directory, next to <em>src</em>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> adder;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">it_adds_two</span></span>() &#123;</span><br><span class="line">	<span class="built_in">assert_eq!</span>(<span class="number">4</span>, adder::add_two(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We’ve added <code>use adder</code> at the top of the code, which we didn’t need in the unit tests. The reason is that each test in the <code>tests</code> directory is a separate crate, so we need to bring our library into each test crate’s scope. We don’t need to annotate any code in <em>tests/integration_test.rs</em> with <code>#[cfg(test)]</code>. </p>
<p>We can still run a particular integration test function by specifying the test function’s name as an argument to <code>cargo test</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span> --test func_name</span><br></pre></td></tr></table></figure>
<h5 id="11-3-2-2-Submodules-in-Integration-Tests"><a href="#11-3-2-2-Submodules-in-Integration-Tests" class="headerlink" title="11.3.2.2 Submodules in Integration Tests"></a>11.3.2.2 Submodules in Integration Tests</h5><p>To avoid having <code>common</code> appear in the test output, instead of creating <em>tests/common.rs</em>, we’ll create <em>tests/common/mod.rs</em>. This is an alternate naming convention that Rust also understands. Naming the file this way tells Rust not to treat the <code>common</code> module as an integration test file. </p>
<p>When we move the <code>setup</code> function code into <em>tests/common/mod.rs</em> and delete the <em>tests/common.rs</em> file, the section in the test output will no longer appear. Files in subdirectories of the <em>tests</em> directory don’t get compiled as separate crates or have sections in the test output.</p>
<h5 id="11-3-2-3-Integration-Tests-for-Binary-Crates"><a href="#11-3-2-3-Integration-Tests-for-Binary-Crates" class="headerlink" title="11.3.2.3 Integration Tests for Binary Crates"></a>11.3.2.3 Integration Tests for Binary Crates</h5><p>If our project is a binary crate that only contains a <em>src/main.rs</em> file and doesn’t have a <em>src/lib.rs</em> file, we can’t create integration tests in the <em>tests</em> directory and bring functions defined in the <em>src/main.rs</em> file into scope with a <code>use</code> statement. Only library crates expose functions that other crates can use; binary crates are meant to be run on their own.</p>
<p>This is one of the reasons Rust projects that provide a binary have a straightforward <em>src/main.rs</em> file that calls logic that lives in the <em>src/lib.rs</em> file. Using that structure, integration tests <em>can</em> test the library crate with <code>use</code> to make the important functionality available. If the important functionality works, the small amount of code in the <em>src/main.rs</em> file will work as well, and that small amount of code doesn’t need to be tested.</p>
<h2 id="12-An-I-O-Project-Building-a-Command-Line-Program"><a href="#12-An-I-O-Project-Building-a-Command-Line-Program" class="headerlink" title="12 An I/O Project: Building a Command Line Program"></a>12 An I/O Project: Building a Command Line Program</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// collect is one function you do often need to annotate because Rust isn’t able to infer the kind of collection you want</span></span><br><span class="line">    <span class="comment">// immediately use collect to turn the iterator into a vector containing all the values produced by the iterator</span></span><br><span class="line">    <span class="keyword">let</span> args: <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt; = env::args().collect();</span><br><span class="line">    <span class="keyword">let</span> query = &amp;args[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> filename = &amp;args[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">let</span> contents = fs::read_to_string(filename)</span><br><span class="line">    	.expect(<span class="string">"wrong reading file..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// cargo run test text</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>std::env::args</code> returns an iterator that produces <code>String</code> values</p>
</li>
<li><p><code>std::env::args_os</code> returns an iterator that produces <code>OsString</code> values</p>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Extracting the Argument Parser</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> args: <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt; = env::args().collect();</span><br><span class="line">    <span class="keyword">let</span> (query, filename) = parse_config(&amp;args);</span><br><span class="line">    <span class="keyword">let</span> contents = fs::read_to_string(filename)</span><br><span class="line">    	.expect(<span class="string">"wrong reading file..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">parse_config</span></span>(args: &amp;[<span class="built_in">String</span>]) -&gt; (&amp;<span class="keyword">str</span>, &amp;<span class="keyword">str</span>) &#123;</span><br><span class="line">	<span class="keyword">let</span> query = &amp;args[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> filename = &amp;args[<span class="number">2</span>];</span><br><span class="line">    (query, filename)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It’s okay to use <code>clone</code> to copy a few strings to continue making progress.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Grouping Configuration Values</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> args: <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt; = env::args().collect();</span><br><span class="line">    <span class="keyword">let</span> config = parse_config(&amp;args);</span><br><span class="line">    <span class="keyword">let</span> contents = fs::read_to_string(config.filename)</span><br><span class="line">    	.expect(<span class="string">"wrong reading file..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Config</span></span> &#123;</span><br><span class="line">	query: <span class="built_in">String</span>,</span><br><span class="line">    filename: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">parse_config</span></span>(&amp;args: &amp;[<span class="built_in">String</span>]) -&gt; Config &#123;</span><br><span class="line">	<span class="keyword">let</span> query = args[<span class="number">1</span>].clone();</span><br><span class="line">    <span class="keyword">let</span> filename = args[<span class="number">2</span>].clone();</span><br><span class="line">    Config &#123;query, filename&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>parse_config</code> function is to create a <code>Config</code> instance, we can change <code>parse_config</code> from a plain function to a function named <code>new</code> that is associated with the <code>Config</code> struct. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating a Constructor for Config</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> args: <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt; = env::args().collect();</span><br><span class="line">    <span class="keyword">let</span> config = Config::new(&amp;args);</span><br><span class="line">    <span class="keyword">let</span> contents = fs::read_to_string(config.filename)</span><br><span class="line">    	.expect(<span class="string">"wrong reading file..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Config</span></span> &#123;</span><br><span class="line">	query: <span class="built_in">String</span>,</span><br><span class="line">    filename: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Config &#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(&amp;args: &amp;[<span class="built_in">String</span>]) -&gt; Config &#123;</span><br><span class="line">    	<span class="keyword">let</span> query = args[<span class="number">1</span>].clone();</span><br><span class="line">        <span class="keyword">let</span> filename = args[<span class="number">2</span>].clone();</span><br><span class="line">        Config &#123;query, filename&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Improving the Error Message</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(&amp;args: &amp;[<span class="built_in">String</span>]) -&gt; Config &#123;</span><br><span class="line">	<span class="keyword">if</span> args.len() &lt; <span class="number">3</span> &#123;</span><br><span class="line">    	<span class="built_in">panic!</span>(<span class="string">"not enough arguments);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// USE</span></span><br><span class="line"><span class="comment">// Returning a Result from new Instead of Calling panic!</span></span><br><span class="line"><span class="keyword">impl</span> Config &#123;</span><br><span class="line">	<span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(args: &amp;[<span class="built_in">String</span>]) -&gt; <span class="built_in">Result</span>&lt;Config, &amp;<span class="symbol">'static</span> <span class="keyword">str</span>&gt; &#123;</span><br><span class="line">    	<span class="keyword">if</span> args.len() &lt; <span class="number">3</span> &#123;</span><br><span class="line">        	<span class="keyword">return</span> <span class="literal">Err</span>(<span class="string">"not enough arguments"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> query = args[<span class="number">1</span>].clone();</span><br><span class="line">        <span class="keyword">let</span> filename = args[<span class="number">2</span>].clone();</span><br><span class="line">        <span class="literal">Ok</span>(Config &#123; query, filename&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// USE</span></span><br><span class="line"><span class="comment">// Calling Config::new and Handling Errors</span></span><br><span class="line"><span class="keyword">use</span> std::process;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> args: <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt; = env::args().collect();</span><br><span class="line">    <span class="comment">// Using unwrap_or_else allows us to define some custom, non-panic! error handling.</span></span><br><span class="line">    <span class="keyword">let</span> config = Config::new(&amp;args).unwrap_or_else(|err| &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Problem parsing arguments: &#123;&#125;"</span>, err);</span><br><span class="line">        process::exit(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Extracting Logic from main</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">	<span class="comment">// --snip--</span></span><br><span class="line">    run(config);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">run</span></span>(config: Config) &#123;</span><br><span class="line">	<span class="keyword">let</span> contents = fs::read_to_string(config.filename)</span><br><span class="line">    	.expect(<span class="string">"wrong reading file..."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// USE</span></span><br><span class="line"><span class="comment">// Returning Errors from the run Function</span></span><br><span class="line"><span class="keyword">use</span> std::error::Error;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">run</span></span>(config: Config) -&gt; <span class="built_in">Result</span>&lt;(), <span class="built_in">Box</span>&lt;dyn Error&gt;&gt; &#123;</span><br><span class="line">    <span class="comment">// removed the call to expect in favor of ? rather than panic! on an error,</span></span><br><span class="line">    <span class="comment">// ? will return the error value from the current function for the caller to handle.</span></span><br><span class="line">	<span class="keyword">let</span> contents = fs::read_to_string(config.filename)?;</span><br><span class="line">    <span class="literal">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// USE</span></span><br><span class="line"><span class="comment">// Handling Errors Returned from run in main</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Err</span>(e) = run(config) &#123;</span><br><span class="line">    	<span class="built_in">println!</span>(<span class="string">"App error: &#123;&#125;"</span>, e);</span><br><span class="line">        process::exit(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// USE</span></span><br><span class="line"><span class="comment">// Spliting Code into a Library Crate</span></span><br><span class="line"><span class="comment">// src/lib.rs</span></span><br><span class="line"><span class="keyword">use</span> std::error::Error;</span><br><span class="line"><span class="keyword">use</span> std::fs;</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Config</span></span> &#123;</span><br><span class="line">	<span class="keyword">pub</span> query: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> filename: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> Config &#123;</span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(args: &amp;[<span class="built_in">String</span>]) -&gt; <span class="built_in">Result</span>&lt;Config, &amp;<span class="symbol">'static</span> <span class="keyword">str</span>&gt; &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">run</span></span>(config: Config) -&gt; <span class="built_in">Result</span>&lt;(), <span class="built_in">Box</span>&lt;dyn Error&gt;&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// src/main.rs</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> minigrep;</span><br><span class="line"><span class="keyword">use</span> std::env;</span><br><span class="line"><span class="keyword">use</span> std::process;</span><br><span class="line"><span class="keyword">use</span> minigrep::Config;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> len <span class="literal">Err</span>(e) = minigrep::run(config) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Test-Driven<ul>
<li>Write a test that fails and run it to make sure it fails for the reason you expect.</li>
<li>Write or modify just enough code to make the new test pass.</li>
<li>Refactor the code you just added or changed and make sure the tests continue to pass.</li>
<li>Repeat from step 1!</li>
</ul>
</li>
</ul>
<p>The whole code can be found here: <a href="https://github.com/hscspring/Coding-Collections/tree/master/Rust/minigrep" target="_blank" rel="noopener">Coding-Collections/Rust/minigrep</a>.</p>
<h2 id="13-Functional-Language-Features-Iterators-and-Closures"><a href="#13-Functional-Language-Features-Iterators-and-Closures" class="headerlink" title="13 Functional Language Features: Iterators and Closures"></a>13 Functional Language Features: Iterators and Closures</h2><h3 id="13-1-Closures-Anonymous-Functions"><a href="#13-1-Closures-Anonymous-Functions" class="headerlink" title="13.1 Closures: Anonymous Functions"></a>13.1 Closures: Anonymous Functions</h3><p>Rust’s closures are anonymous functions you can save in a variable or pass as arguments to other functions. We want to define code in one place in our program, but only <em>execute</em> that code where we actually need the result. This is a use case for closures!</p>
<h4 id="13-1-1-Creating-an-Abstraction-of-Behavior-with-Closures"><a href="#13-1-1-Creating-an-Abstraction-of-Behavior-with-Closures" class="headerlink" title="13.1.1 Creating an Abstraction of Behavior with Closures"></a>13.1.1 Creating an Abstraction of Behavior with Closures</h4><p>We can define a closure and store the <em>closure</em> in a variable rather than storing the result of the function call:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> expensive_closure = |num| &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"calculating slowly..."</span>);</span><br><span class="line">    thread::sleep(Duration::from_secs(<span class="number">2</span>));</span><br><span class="line">    num</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">generate_workout</span></span>(intensity: <span class="keyword">u32</span>, random_number: <span class="keyword">u32</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> expensive_closure = |num| &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"calculating slowly..."</span>);</span><br><span class="line">        thread::sleep(Duration::from_secs(<span class="number">2</span>));</span><br><span class="line">        num</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> intensity &lt; <span class="number">25</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">"Today, do &#123;&#125; pushups!"</span>,</span><br><span class="line">            expensive_closure(intensity)</span><br><span class="line">        );</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">"Next, do &#123;&#125; situps!"</span>,</span><br><span class="line">            expensive_closure(intensity)</span><br><span class="line">        );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> random_number == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"Take a break today! Remember to stay hydrated!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(</span><br><span class="line">                <span class="string">"Today, run for &#123;&#125; minutes!"</span>,</span><br><span class="line">                expensive_closure(intensity)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that this <code>let</code> statement means <code>expensive_closure</code> contains the <em>definition</em> of an anonymous function, not the <em>resulting value</em> of calling the anonymous function. </p>
<p>Now the expensive calculation is called in only one place, and we’re only executing that code where we need the results. </p>
<p>However, we’re still calling the closure twice in the first <code>if</code> block, which will call the expensive code twice and make the user wait twice as long as they need to.</p>
<h4 id="13-1-2-Closure-Type-Inference-and-Annotation"><a href="#13-1-2-Closure-Type-Inference-and-Annotation" class="headerlink" title="13.1.2 Closure Type Inference and Annotation"></a>13.1.2 Closure Type Inference and Annotation</h4><p>Closures don’t require you to annotate the types of the parameters or the return value like <code>fn</code> functions do. Type annotations are required on functions because they’re part of an explicit interface exposed to your users.  Defining this interface rigidly is important for ensuring that everyone agrees on what types of values a function uses and returns. But closures aren’t used in an exposed interface like this: they’re stored in variables and used without naming them and exposing them to users of our library.</p>
<h4 id="13-1-3-Storing-Closures-Using-Generic-Parameters-and-the-Fn-Traits"><a href="#13-1-3-Storing-Closures-Using-Generic-Parameters-and-the-Fn-Traits" class="headerlink" title="13.1.3 Storing Closures Using Generic Parameters and the Fn Traits"></a>13.1.3 Storing Closures Using Generic Parameters and the <code>Fn</code> Traits</h4><p>For the problem (still calling the closure twice in the first <code>if</code> block) before, we can create a struct that will hold the closure and the resulting value of calling the closure. The struct will execute the closure only if we need the resulting value, and it will cache the resulting value so the rest of our code doesn’t have to be responsible for saving and reusing the result. You may know this pattern as <em>memoization</em> or <em>lazy evaluation</em>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cacher</span></span>&lt;T&gt;</span><br><span class="line">    <span class="keyword">where</span> T: <span class="built_in">Fn</span>(<span class="keyword">u32</span>) -&gt; <span class="keyword">u32</span></span><br><span class="line">&#123;</span><br><span class="line">    calculation: T,</span><br><span class="line">    value: <span class="built_in">Option</span>&lt;<span class="keyword">u32</span>&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>Cacher</code> struct has a <code>calculation</code> field of the generic type <code>T</code>. The trait bounds on <code>T</code> specify that it’s a closure by using the <code>Fn</code> trait. Any closure we want to store in the <code>calculation</code> field must have one <code>u32</code> parameter (specified within the parentheses after <code>Fn</code>) and must return a <code>u32</code>(specified after the <code>-&gt;</code>).</p>
<p>The <code>value</code> field is of type <code>Option&lt;u32&gt;</code>. Before we execute the closure, <code>value</code> will be <code>None</code>. When code using a <code>Cacher</code> asks for the <em>result</em> of the closure, the <code>Cacher</code> will execute the closure at that time and store the result within a <code>Some</code> variant in the <code>value</code> field. Then if the code asks for the result of the closure again, instead of executing the closure again, the <code>Cacher</code> will return the result held in the <code>Some</code> variant.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T&gt; Cacher&lt;T&gt;</span><br><span class="line">    <span class="keyword">where</span> T: <span class="built_in">Fn</span>(<span class="keyword">u32</span>) -&gt; <span class="keyword">u32</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(calculation: T) -&gt; Cacher&lt;T&gt; &#123;</span><br><span class="line">        Cacher &#123;</span><br><span class="line">            calculation,</span><br><span class="line">            value: <span class="literal">None</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">value</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, arg: <span class="keyword">u32</span>) -&gt; <span class="keyword">u32</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span>.value &#123;</span><br><span class="line">            <span class="literal">Some</span>(v) =&gt; v,</span><br><span class="line">            <span class="literal">None</span> =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span> v = (<span class="keyword">self</span>.calculation)(arg);</span><br><span class="line">                <span class="keyword">self</span>.value = <span class="literal">Some</span>(v);</span><br><span class="line">                v</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">generate_workout</span></span>(intensity: <span class="keyword">u32</span>, random_number: <span class="keyword">u32</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> expensive_result = Cacher::new(|num| &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"calculating slowly..."</span>);</span><br><span class="line">        thread::sleep(Duration::from_secs(<span class="number">2</span>));</span><br><span class="line">        num</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> intensity &lt; <span class="number">25</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">"Today, do &#123;&#125; pushups!"</span>,</span><br><span class="line">            expensive_result.value(intensity)</span><br><span class="line">        );</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">"Next, do &#123;&#125; situps!"</span>,</span><br><span class="line">            expensive_result.value(intensity)</span><br><span class="line">        );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> random_number == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"Take a break today! Remember to stay hydrated!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(</span><br><span class="line">                <span class="string">"Today, run for &#123;&#125; minutes!"</span>,</span><br><span class="line">                expensive_result.value(intensity)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Instead of saving the closure in a variable directly, we save a new instance of <code>Cacher</code> that holds the closure. Then, in each place we want the result, we call the <code>value</code> method on the <code>Cacher</code> instance. We can call the <code>value</code> method as many times as we want, or not call it at all, and the expensive calculation will be run a maximum of once.</p>
<h4 id="13-1-4-Limitations-of-the-Cacher-Implementation"><a href="#13-1-4-Limitations-of-the-Cacher-Implementation" class="headerlink" title="13.1.4 Limitations of the Cacher Implementation"></a>13.1.4 Limitations of the <code>Cacher</code> Implementation</h4><p>The first problem is that a <code>Cacher</code> instance assumes it will always get the same value for the parameter <code>arg</code> to the <code>value</code> method. Try modifying <code>Cacher</code> to hold a hash map rather than a single value. The keys of the hash map will be the <code>arg</code> values that are passed in, and the values of the hash map will be the result of calling the closure on that key. Instead of looking at whether <code>self.value</code> directly has a <code>Some</code> or a <code>None</code> value, the <code>value</code> function will look up the <code>arg</code> in the hash map and return the value if it’s present. If it’s not present, the <code>Cacher</code> will call the closure and save the resulting value in the hash map associated with its <code>arg</code> value.</p>
<p>The second problem with the current <code>Cacher</code> implementation is that it only accepts closures that take one parameter of type <code>u32</code> and return a <code>u32</code>. We might want to cache the results of closures that take a string slice and return <code>usize</code> values, for example. To fix this issue, try introducing more generic parameters to increase the flexibility of the <code>Cacher</code> functionality.</p>
<h4 id="13-1-5-Capturing-the-Environment-with-Closures"><a href="#13-1-5-Capturing-the-Environment-with-Closures" class="headerlink" title="13.1.5 Capturing the Environment with Closures"></a>13.1.5 Capturing the Environment with Closures</h4><p>Closures have an additional capability that functions don’t have: <strong>they can capture their environment and access variables from the scope in which they’re defined.</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> equal_to_x = |z| z == x;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> y = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert!</span>(equal_to_x(y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="number">4</span>;</span><br><span class="line">	<span class="comment">// function</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">equal_to_x</span></span>(z: <span class="keyword">i32</span>) -&gt; <span class="keyword">bool</span> &#123; z == x &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> y = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert!</span>(equal_to_x(y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// can't capture dynamic environment in a fn item; use the || &#123; ...&#125; closure form instead</span></span><br></pre></td></tr></table></figure>
<p>Closures can capture values from their environment in three ways, which directly map to the three ways a function can take a parameter: taking ownership, borrowing mutably, and borrowing immutably. These are encoded in the three <code>Fn</code> traits as follows:</p>
<ul>
<li><code>FnOnce</code> consumes the variables it captures from its enclosing scope, known as the closure’s <em>environment</em>. To consume the captured variables, the closure must take ownership of these variables and move them into the closure when it is defined. The <code>Once</code> part of the name represents the fact that the closure can’t take ownership of the same variables more than once, so it can be called only once.</li>
<li><code>FnMut</code> can change the environment because it mutably borrows values.</li>
<li><code>Fn</code> borrows values from the environment immutably.</li>
</ul>
<p>When you create a closure, Rust infers which trait to use based on how the closure uses the values from the environment. All closures implement <code>FnOnce</code> because they can all be called at least once. Closures that don’t move the captured variables also implement <code>FnMut</code>, and closures that don’t need mutable access to the captured variables also implement <code>Fn</code>. </p>
<p>If you want to force the closure to take ownership of the values it uses in the environment, you can use the <code>move</code> keyword before the parameter list. This technique is mostly useful when passing a closure to a new thread to move the data so it’s owned by the new thread.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> equal_to_x = <span class="keyword">move</span> |z| z == x;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"can't use x here: &#123;:?&#125;"</span>, x);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> y = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert!</span>(equal_to_x(y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>x</code> value is moved into the closure when the closure is defined, because we added the <code>move</code> keyword. The closure then has ownership of <code>x</code>, and <code>main</code> isn’t allowed to use <code>x</code> anymore in the <code>println!</code> statement. Removing <code>println!</code> will fix this example.</p>
<p>Most of the time when specifying one of the <code>Fn</code> trait bounds, you can start with <code>Fn</code> and the compiler will tell you if you need <code>FnMut</code> or <code>FnOnce</code> based on what happens in the closure body.</p>
<h3 id="13-2-Processing-a-Series-of-Items-with-Iterators"><a href="#13-2-Processing-a-Series-of-Items-with-Iterators" class="headerlink" title="13.2 Processing a Series of Items with Iterators"></a>13.2 Processing a Series of Items with Iterators</h3><p>In Rust, iterators are <em>lazy</em>, meaning they have no effect until you call methods that consume the iterator to use it up. </p>
<h4 id="13-2-1-The-Iterator-Trait-and-the-Next-Method"><a href="#13-2-1-The-Iterator-Trait-and-the-Next-Method" class="headerlink" title="13.2.1 The Iterator Trait and the Next Method"></a>13.2.1 The <code>Iterator</code> Trait and the <code>Next</code> Method</h4><p>All iterators implement a trait named <code>Iterator</code> that is defined in the standard library.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Iterator</span></span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Item</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">next</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">Option</span>&lt;Self::Item&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// methods with default implementations elided</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">iterator_demonstration</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> v1 = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> v1_iter = v1.iter();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">Some</span>(&amp;<span class="number">1</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">Some</span>(&amp;<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">Some</span>(&amp;<span class="number">3</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">None</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that we needed to make <code>v1_iter</code> mutable: calling the <code>next</code> method on an iterator changes internal state that the iterator uses to keep track of where it is in the sequence. In other words, this code <em>consumes</em>, or uses up, the iterator. Each call to <code>next</code> eats up an item from the iterator. We didn’t need to make <code>v1_iter</code> mutable when we used a <code>for</code> loop because the loop took ownership of <code>v1_iter</code> and made it mutable behind the scenes.</p>
<p>Also note that the values we get from the calls to <code>next</code> are immutable references to the values in the vector. The <code>iter</code> method produces an iterator over immutable references. </p>
<ul>
<li>If we want to create an iterator that takes ownership of <code>v1</code> and returns owned values, we can call <code>into_iter</code> instead of <code>iter</code>. </li>
<li>Similarly, if we want to iterate over mutable references, we can call <code>iter_mut</code> instead of <code>iter</code>.</li>
</ul>
<h4 id="13-2-2-Methods-that-Consume-the-Iterator"><a href="#13-2-2-Methods-that-Consume-the-Iterator" class="headerlink" title="13.2.2 Methods that Consume the Iterator"></a>13.2.2 Methods that Consume the Iterator</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">iterator_sum</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> v1 = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> v1_iter = v1.iter();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> total: <span class="keyword">i32</span> = v1_iter.sum();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(total, <span class="number">6</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We aren’t allowed to use <code>v1_iter</code> after the call to <code>sum</code> because <code>sum</code> takes ownership of the iterator we call it on.</p>
<h4 id="13-2-3-Methods-that-Produce-Other-Iterators"><a href="#13-2-3-Methods-that-Produce-Other-Iterators" class="headerlink" title="13.2.3 Methods that Produce Other Iterators"></a>13.2.3 Methods that Produce Other Iterators</h4><p>Other methods defined on the <code>Iterator</code> trait, known as <em>iterator adaptors</em>, allow you to change iterators into different kinds of iterators. You can chain multiple calls to iterator adaptors to perform complex actions in a readable way. But because all iterators are lazy, you have to call one of the consuming adaptor methods to get results from calls to iterator adaptors.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v1: <span class="built_in">Vec</span>&lt;<span class="keyword">i32</span>&gt; = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">v1.iter().map(|x| x + <span class="number">1</span>);</span><br><span class="line"><span class="comment">// warning: unused `std::iter::Map` which must be used: iterator adaptors are lazy and do nothing unless consumed</span></span><br></pre></td></tr></table></figure>
<p>This code doesn’t do anything; the closure we’ve specified never gets called. The warning reminds us why: iterator adaptors are lazy, and we need to consume the iterator here.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v1: <span class="built_in">Vec</span>&lt;<span class="keyword">i32</span>&gt; = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> v2: <span class="built_in">Vec</span>&lt;_&gt; = v1.iter().map(|x| x + <span class="number">1</span>).collect();</span><br><span class="line"></span><br><span class="line"><span class="built_in">assert_eq!</span>(v2, <span class="built_in">vec!</span>[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"><span class="comment">// collect consumes the iterator and collects the resulting values into a collection data type.</span></span><br></pre></td></tr></table></figure>
<p>Because <code>map</code> takes a closure, we can specify any operation we want to perform on each item. This is a great example of how closures let you customize some behavior while reusing the iteration behavior that the <code>Iterator</code> trait provides.</p>
<h4 id="13-2-4-Using-Closures-that-Capture-Their-Environment"><a href="#13-2-4-Using-Closures-that-Capture-Their-Environment" class="headerlink" title="13.2.4 Using Closures that Capture Their Environment"></a>13.2.4 Using Closures that Capture Their Environment</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Shoe</span></span> &#123;</span><br><span class="line">    size: <span class="keyword">u32</span>,</span><br><span class="line">    style: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">shoes_in_my_size</span></span>(shoes: <span class="built_in">Vec</span>&lt;Shoe&gt;, shoe_size: <span class="keyword">u32</span>) -&gt; <span class="built_in">Vec</span>&lt;Shoe&gt; &#123;</span><br><span class="line">    <span class="comment">// filter to adapt that iterator </span></span><br><span class="line">    shoes.into_iter()</span><br><span class="line">        .filter(|s| s.size == shoe_size)</span><br><span class="line">        .collect()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">filters_by_size</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> shoes = <span class="built_in">vec!</span>[</span><br><span class="line">        Shoe &#123; size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">"sneaker"</span>) &#125;,</span><br><span class="line">        Shoe &#123; size: <span class="number">13</span>, style: <span class="built_in">String</span>::from(<span class="string">"sandal"</span>) &#125;,</span><br><span class="line">        Shoe &#123; size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">"boot"</span>) &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> in_my_size = shoes_in_my_size(shoes, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        in_my_size,</span><br><span class="line">        <span class="built_in">vec!</span>[</span><br><span class="line">            Shoe &#123; size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">"sneaker"</span>) &#125;,</span><br><span class="line">            Shoe &#123; size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">"boot"</span>) &#125;,</span><br><span class="line">        ]</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The closure captures the <code>shoe_size</code> parameter from the environment and compares the value with each shoe’s size, keeping only shoes of the size specified. </p>
<h4 id="13-2-5-Creating-Our-Own-Iterators-with-the-Iterator-Trait"><a href="#13-2-5-Creating-Our-Own-Iterators-with-the-Iterator-Trait" class="headerlink" title="13.2.5 Creating Our Own Iterators with the Iterator Trait"></a>13.2.5 Creating Our Own Iterators with the <code>Iterator</code> Trait</h4><p>You can create iterators that do anything you want by implementing the <code>Iterator</code> trait on your own types. As previously mentioned, the only method you’re required to provide a definition for is the <code>next</code> method. Once you’ve done that, you can use all other methods that have default implementations provided by the <code>Iterator</code> trait!</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Counter</span></span> &#123;</span><br><span class="line">    count: <span class="keyword">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Counter &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; Counter &#123;</span><br><span class="line">        Counter &#123; count: <span class="number">0</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="built_in">Iterator</span> <span class="keyword">for</span> Counter &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Item</span></span> = <span class="keyword">u32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">next</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">Option</span>&lt;Self::Item&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.count += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.count &lt; <span class="number">6</span> &#123;</span><br><span class="line">            <span class="literal">Some</span>(<span class="keyword">self</span>.count)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="13-2-5-1-Using-Our-Counter-Iterator’s-next-method"><a href="#13-2-5-1-Using-Our-Counter-Iterator’s-next-method" class="headerlink" title="13.2.5.1 Using Our Counter Iterator’s next method"></a>13.2.5.1 Using Our <code>Counter</code> Iterator’s <code>next</code> method</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">calling_next_directly</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> counter = Counter::new();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">Some</span>(<span class="number">1</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">Some</span>(<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">Some</span>(<span class="number">3</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">Some</span>(<span class="number">4</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">Some</span>(<span class="number">5</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">None</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="13-2-5-2-Using-Other-Iterator-Trait-Methods"><a href="#13-2-5-2-Using-Other-Iterator-Trait-Methods" class="headerlink" title="13.2.5.2 Using Other Iterator Trait Methods"></a>13.2.5.2 Using Other <code>Iterator</code> Trait Methods</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">using_other_iterator_trait_methods</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> sum: <span class="keyword">u32</span> = Counter::new().zip(Counter::new().skip(<span class="number">1</span>))</span><br><span class="line">                                 .map(|(a, b)| a * b)</span><br><span class="line">                                 .filter(|x| x % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">                                 .sum();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">18</span>, sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that <code>zip</code> produces only four pairs; the theoretical fifth pair <code>(5, None)</code> is never produced because <code>zip</code> returns <code>None</code> when either of its input iterators return <code>None</code>.</p>
<h3 id="13-3-Improving-Our-I-O-Project"><a href="#13-3-Improving-Our-I-O-Project" class="headerlink" title="13.3 Improving Our I/O Project"></a>13.3 Improving Our I/O Project</h3><h4 id="13-3-1-Removing-a-clone-Using-an-Iterator"><a href="#13-3-1-Removing-a-clone-Using-an-Iterator" class="headerlink" title="13.3.1 Removing a clone Using an Iterator"></a>13.3.1 Removing a <code>clone</code> Using an Iterator</h4><p>The IO project can be found <a href="https://github.com/hscspring/Coding-Collections/tree/master/Rust/minigrep" target="_blank" rel="noopener">here</a>, <code>clone</code> is used to make the <code>Config</code> own the values.</p>
<p>Here we change the <code>new</code> function to take ownership of an iterator as its argument instead of borrowing a slice.</p>
<h5 id="13-3-1-1-Using-the-Returned-Iterator-Directly"><a href="#13-3-1-1-Using-the-Returned-Iterator-Directly" class="headerlink" title="13.3.1.1 Using the Returned Iterator Directly"></a>13.3.1.1 Using the Returned Iterator Directly</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// modify the src/main.rs</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> config = Config::new(env::args()).unwrap_or_else(|err| &#123;</span><br><span class="line">        eprintln!(<span class="string">"Problem parsing arguments: &#123;&#125;"</span>, err);</span><br><span class="line">        process::exit(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>env::args()</code> function returns an iterator! Rather than collecting the iterator values into a vector and then passing a slice to <code>Config::new</code>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// update src/lib.rs</span></span><br><span class="line"><span class="keyword">impl</span> Config &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(<span class="keyword">mut</span> args: std::env::Args) -&gt; <span class="built_in">Result</span>&lt;Config, &amp;<span class="symbol">'static</span> <span class="keyword">str</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// --snip--</span></span><br></pre></td></tr></table></figure>
<p>The standard library documentation for the <code>env::args</code> function shows that the type of the iterator it returns is <code>std::env::Args</code>. Because we’re taking ownership of <code>args</code> and we’ll be mutating <code>args</code> by iterating over it, we can add the <code>mut</code> keyword into the specification of the <code>args</code> parameter to make it mutable.</p>
<h5 id="13-3-1-2-Using-Iterator-Trait-Methods-Instead-of-Indexing"><a href="#13-3-1-2-Using-Iterator-Trait-Methods-Instead-of-Indexing" class="headerlink" title="13.3.1.2 Using Iterator Trait Methods Instead of Indexing"></a>13.3.1.2 Using <code>Iterator</code> Trait Methods Instead of Indexing</h5><p>The standard library documentation also mentions that <code>std::env::Args</code> implements the <code>Iterator</code> trait, so we know we can call the <code>next</code> method on it!</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Config &#123;</span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(<span class="keyword">mut</span> args: std::env::Args) -&gt; <span class="built_in">Result</span>&lt;Config, &amp;<span class="symbol">'static</span> <span class="keyword">str</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// the first value in the return value of env::args is the name of the program.</span></span><br><span class="line">    	args.next();</span><br><span class="line">        <span class="keyword">let</span> query = <span class="keyword">match</span> args.next() &#123;</span><br><span class="line">        	<span class="literal">Some</span>(arg) =&gt; arg,</span><br><span class="line">            <span class="literal">None</span> =&gt; <span class="keyword">return</span> <span class="literal">Err</span>(<span class="string">"Didn't get a query string"</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> filename = <span class="keyword">match</span> args.next() &#123;</span><br><span class="line">        	<span class="literal">Some</span>(arg) =&gt; arg,</span><br><span class="line">            <span class="literal">None</span> =&gt; <span class="keyword">return</span> <span class="literal">Err</span>(<span class="string">"Didn't get a file name"</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> case_sensitive = env::var(<span class="string">"CASE_INSENSITIVE"</span>).is_err();</span><br><span class="line">        <span class="literal">Ok</span>(Config &#123;query, filename, case_sensitive&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="13-3-2-Making-Code-Clearer-with-Iterator-Adaptors"><a href="#13-3-2-Making-Code-Clearer-with-Iterator-Adaptors" class="headerlink" title="13.3.2 Making Code Clearer with Iterator Adaptors"></a>13.3.2 Making Code Clearer with Iterator Adaptors</h4><p>We can write the <code>search</code> code in a more concise way using iterator adaptor methods. Doing so also lets us avoid having a mutable intermediate <code>results</code> vector. The functional programming style prefers to minimize the amount of mutable state to make code clearer. Removing the mutable state might enable a future enhancement to make searching happen in parallel, because we wouldn’t have to manage concurrent access to the <code>results</code> vector. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">search</span></span>&lt;<span class="symbol">'a</span>&gt;(query: &amp;<span class="keyword">str</span>, contents: &amp;<span class="symbol">'a</span> <span class="keyword">str</span>) -&gt; <span class="built_in">Vec</span>&lt;&amp;<span class="symbol">'a</span> <span class="keyword">str</span>&gt; &#123;</span><br><span class="line">	contents.lines()</span><br><span class="line">    	.filter(|line| line.contains(query))</span><br><span class="line">    	.collect()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13-4-Comparing-Performance-Loop-vs-Iterators"><a href="#13-4-Comparing-Performance-Loop-vs-Iterators" class="headerlink" title="13.4 Comparing Performance: Loop vs. Iterators"></a>13.4 Comparing Performance: Loop vs. Iterators</h3><p>The iterator version was slightly faster! The point is this: iterators, although a high-level abstraction, get compiled down to roughly the same code as if you’d written the lower-level code yourself. Iterators are one of Rust’s <em>zero-cost abstractions</em>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// another example</span></span><br><span class="line"><span class="keyword">let</span> buffer: &amp;<span class="keyword">mut</span> [<span class="keyword">i32</span>];</span><br><span class="line"><span class="keyword">let</span> coefficients: [<span class="keyword">i64</span>; <span class="number">12</span>];</span><br><span class="line"><span class="keyword">let</span> qlp_shift: <span class="keyword">i16</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">12</span>..buffer.len() &#123;</span><br><span class="line">    <span class="keyword">let</span> prediction = coefficients.iter()</span><br><span class="line">                                 .zip(&amp;buffer[i - <span class="number">12</span>..i])</span><br><span class="line">                                 .map(|(&amp;c, &amp;s)| c * s <span class="keyword">as</span> <span class="keyword">i64</span>)</span><br><span class="line">                                 .sum::&lt;<span class="keyword">i64</span>&gt;() &gt;&gt; qlp_shift;</span><br><span class="line">    <span class="keyword">let</span> delta = buffer[i];</span><br><span class="line">    buffer[i] = prediction <span class="keyword">as</span> <span class="keyword">i32</span> + delta;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There’s no loop at all corresponding to the iteration over the values in <code>coefficients</code>: Rust knows that there are 12 iterations, so it “unrolls” the loop. <em>Unrolling</em> is an optimization that removes the overhead of the loop controlling code and instead generates repetitive code for each iteration of the loop.</p>
<p>You can use iterators and closures without fear! They make code seem like it’s higher level but don’t impose a runtime performance penalty for doing so.</p>
<h2 id="14-More-About-Cargo-and-Crates-io"><a href="#14-More-About-Cargo-and-Crates-io" class="headerlink" title="14 More About Cargo and Crates.io"></a>14 More About Cargo and Crates.io</h2><h3 id="14-1-Customizing-Builds-with-Release-Profiles"><a href="#14-1-Customizing-Builds-with-Release-Profiles" class="headerlink" title="14.1 Customizing Builds with Release Profiles"></a>14.1 Customizing Builds with Release Profiles</h3><p>In Rust, <em>release profiles</em> are predefined and customizable profiles with different configurations that allow a programmer to have more control over various options for compiling code. Each profile is configured independently of the others.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cargo build</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.0 secs</span><br><span class="line">$ cargo build --release</span><br><span class="line">    Finished release [optimized] target(s) <span class="keyword">in</span> 0.0 secs</span><br></pre></td></tr></table></figure>
<p>The <code>dev</code> profile is defined with good defaults for development, and the <code>release</code> profile has good defaults for release builds.</p>
<p>Cargo has default settings for each of the profiles that apply when there aren’t any <code>[profile.*]</code> sections in the project’s <em>Cargo.toml</em> file. By adding <code>[profile.*]</code> sections for any profile you want to customize, you can override any subset of the default settings below.</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[profile.dev]</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[profile.release]</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>The <code>opt-level</code> setting controls the number of optimizations Rust will apply to your code, with a range of 0 to 3. </p>
<h3 id="14-2-Publishing-a-Crate-to-Crates-io"><a href="#14-2-Publishing-a-Crate-to-Crates-io" class="headerlink" title="14.2 Publishing a Crate to Crates.io"></a>14.2 Publishing a Crate to Crates.io</h3><h4 id="14-2-1-Making-Useful-Documentation-Comments"><a href="#14-2-1-Making-Useful-Documentation-Comments" class="headerlink" title="14.2.1 Making Useful Documentation Comments"></a>14.2.1 Making Useful Documentation Comments</h4><p>Rust also has a particular kind of comment for documentation, known conveniently as a <em>documentation comment</em>, that will generate HTML documentation. Documentation comments use three slashes, <code>///</code>, instead of two and support Markdown notation for formatting the text. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/// Adds one to the number given.</span><br><span class="line">///</span><br><span class="line">/// # Examples</span><br><span class="line">///</span><br><span class="line">///</span><br></pre></td></tr></table></figure>
<p>/// let arg = 5;<br>/// let answer = my_crate::add_one(arg);<br>///<br>/// assert_eq!(6, answer);<br>/// <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pub fn add_one(x: i32) -&gt; i32 &#123;</span><br><span class="line">    x + 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Then run <code>cargo doc</code>, the document will be in the <code>target/doc</code> directory.</p>
<h5 id="14-2-1-1-Commonly-Used-Sections"><a href="#14-2-1-1-Commonly-Used-Sections" class="headerlink" title="14.2.1.1 Commonly Used Sections"></a>14.2.1.1 Commonly Used Sections</h5><ul>
<li><p>Examples</p>
</li>
<li><p>Panics: The scenarios in which the function being documented could panic. Callers of the function who don’t want their programs to panic should make sure they don’t call the function in these situations.</p>
</li>
<li>Erros: If the function returns a <code>Result</code>, describing the kinds of errors that might occur and what conditions might cause those errors to be returned can be helpful to callers so they can write code to handle the different kinds of errors in different ways.</li>
<li>Safety: If the function is <code>unsafe</code> to call (we discuss unsafety in Chapter 19), there should be a section explaining why the function is unsafe and covering the invariants that the function expects callers to uphold.</li>
</ul>
<p>Most documentation comments don’t need all of these sections, but this is a good checklist to remind you of the aspects of your code that people calling your code will be interested in knowing about.</p>
<h5 id="14-2-1-2-Documentation-Comments-as-Tests"><a href="#14-2-1-2-Documentation-Comments-as-Tests" class="headerlink" title="14.2.1.2 Documentation Comments as Tests"></a>14.2.1.2 Documentation Comments as Tests</h5><p>Running <code>cargo test</code> will run the code examples in your documentation as tests! </p>
<h5 id="14-2-1-3-Commenting-Contained-Items"><a href="#14-2-1-3-Commenting-Contained-Items" class="headerlink" title="14.2.1.3 Commenting Contained Items"></a>14.2.1.3 Commenting Contained Items</h5><p>Another style of doc comment, <code>//!</code>, we typically use these doc comments inside the crate root file (<em>src/lib.rs</em> by convention) or inside a module to document the crate or the module as a whole. Documentation comments within items are useful for describing crates and modules especially. Use them to explain the overall purpose of the container to help your users understand the crate’s organization.</p>
<h4 id="14-2-2-Exporting-a-Convenient-Public-API-with-pub-use"><a href="#14-2-2-Exporting-a-Convenient-Public-API-with-pub-use" class="headerlink" title="14.2.2 Exporting a Convenient Public API with pub use"></a>14.2.2 Exporting a Convenient Public API with <code>pub use</code></h4><p>If the structure <em>isn’t</em> convenient for others to use from another library, you don’t have to rearrange your internal organization: instead, you can re-export items to make a public structure that’s different from your private structure by using <code>pub use</code>. </p>
<p>Filename: <code>src/lib.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! # Art</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! A library for modeling artistic concepts.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> kinds &#123;</span><br><span class="line">    <span class="comment">/// The primary colors according to the RYB color model.</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="class"><span class="keyword">enum</span> <span class="title">PrimaryColor</span></span> &#123;</span><br><span class="line">        Red,</span><br><span class="line">        Yellow,</span><br><span class="line">        Blue,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The secondary colors according to the RYB color model.</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="class"><span class="keyword">enum</span> <span class="title">SecondaryColor</span></span> &#123;</span><br><span class="line">        Orange,</span><br><span class="line">        Green,</span><br><span class="line">        Purple,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> utils &#123;</span><br><span class="line">    <span class="keyword">use</span> crate::kinds::*;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Combines two primary colors in equal amounts to create</span></span><br><span class="line">    <span class="comment">/// a secondary color.</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">mix</span></span>(c1: PrimaryColor, c2: PrimaryColor) -&gt; SecondaryColor &#123;</span><br><span class="line">        <span class="comment">// --snip--</span></span><br><span class="line">        SecondaryColor::Orange</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Filename: <code>src/main.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> art::kinds::PrimaryColor;</span><br><span class="line"><span class="keyword">use</span> art::utils::mix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> red = PrimaryColor::Red;</span><br><span class="line">    <span class="keyword">let</span> yellow = PrimaryColor::Yellow;</span><br><span class="line">    mix(red, yellow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To remove the internal organization from the public API, we can modify the <code>art</code> crate code to add <code>pub use</code> statements to re-export the items at the top level.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! # Art</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! A library for modeling artistic concepts.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> self::kinds::PrimaryColor;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> self::kinds::SecondaryColor;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> self::utils::mix;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> kinds &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> utils &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Filename: <code>src/main.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> art::PrimaryColor;</span><br><span class="line"><span class="keyword">use</span> art::mix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="14-2-3-Setting-Up-a-Crates-io-Account"><a href="#14-2-3-Setting-Up-a-Crates-io-Account" class="headerlink" title="14.2.3 Setting Up a Crates.io Account"></a>14.2.3 Setting Up a Crates.io Account</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cargo login api_key</span><br></pre></td></tr></table></figure>
<p>This command will inform Cargo of your API token and store it locally in <em>~/.cargo/credentials</em>.</p>
<h4 id="14-2-4-Adding-Metadata-to-a-New-Crate"><a href="#14-2-4-Adding-Metadata-to-a-New-Crate" class="headerlink" title="14.2.4 Adding Metadata to a New Crate"></a>14.2.4 Adding Metadata to a New Crate</h4><p>Before publishing, you’ll need to add some metadata to your crate by adding it to the <code>[package]</code> section of the crate’s <em>Cargo.toml</em> file.</p>
<p>Step1: A unique name</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">"guessing_game"</span></span><br></pre></td></tr></table></figure>
<p>Step2: Add a description and license</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">"guessing_game"</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">"0.1.0"</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">"Your Name &lt;you@example.com&gt;"</span>]</span><br><span class="line"><span class="attr">edition</span> = <span class="string">"2018"</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">"A fun game where you guess what number the computer has chosen."</span></span><br><span class="line"><span class="attr">license</span> = <span class="string">"MIT OR Apache-2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br></pre></td></tr></table></figure>
<h4 id="14-2-5-Publishing-to-Crates-io"><a href="#14-2-5-Publishing-to-Crates-io" class="headerlink" title="14.2.5 Publishing to Crates.io"></a>14.2.5 Publishing to Crates.io</h4><p>Be careful when publishing a crate because a publish is <em>permanent</em>. The version can never be overwritten, and the code cannot be deleted. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cargo publish</span><br></pre></td></tr></table></figure>
<h4 id="14-2-6-Publishing-a-New-Version-of-an-Existing-Crate"><a href="#14-2-6-Publishing-a-New-Version-of-an-Existing-Crate" class="headerlink" title="14.2.6 Publishing a New Version of an Existing Crate"></a>14.2.6 Publishing a New Version of an Existing Crate</h4><p>When you’ve made changes to your crate and are ready to release a new version, you change the <code>version</code> value specified in your <em>Cargo.toml</em> file and republish. Use the <a href="http://semver.org/" target="_blank" rel="noopener">Semantic Versioning rules</a> to decide what an appropriate next version number is based on the kinds of changes you’ve made.</p>
<h4 id="14-2-7-Removing-Versions-from-Crates-io-with-cargo-yank"><a href="#14-2-7-Removing-Versions-from-Crates-io-with-cargo-yank" class="headerlink" title="14.2.7 Removing Versions from Crates.io with cargo yank"></a>14.2.7 Removing Versions from Crates.io with <code>cargo yank</code></h4><p>Although you can’t remove previous versions of a crate, you can prevent any future projects from adding them as a new dependency. </p>
<p>Yanking a version prevents new projects from starting to depend on that version while allowing all existing projects that depend on it to continue to download and depend on that version. Essentially, a yank means that all projects with a <em>Cargo.lock</em> will not break, and any future <em>Cargo.lock</em> files generated will not use the yanked version.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cargo yank --vers 1.0.1</span><br><span class="line">$ cargo yank --vers 1.0.1 --undo</span><br></pre></td></tr></table></figure>
<h3 id="14-3-Cargo-Workspaces"><a href="#14-3-Cargo-Workspaces" class="headerlink" title="14.3 Cargo Workspaces"></a>14.3 Cargo Workspaces</h3><p>As your project develops, you might find that the library crate continues to get bigger and you want to split up your package further into multiple library crates. Cargo offers a feature called <em>workspaces</em> that can help manage multiple related packages that are developed in tandem.</p>
<h4 id="14-3-1-Creating-a-Workspace"><a href="#14-3-1-Creating-a-Workspace" class="headerlink" title="14.3.1 Creating a Workspace"></a>14.3.1 Creating a Workspace</h4><p>A <em>workspace</em> is a set of packages that share the same <em>Cargo.lock</em> and output directory.</p>
<ul>
<li><p>touch <code>Cargo.toml</code>, add <code>[workspace]</code></p>
</li>
<li><p><code>cargo new member</code></p>
</li>
<li><code>cargo build</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── Cargo.lock</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── adder</span><br><span class="line">│   ├── Cargo.toml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── main.rs</span><br><span class="line">└── target</span><br></pre></td></tr></table></figure>
<h4 id="14-3-2-Creating-the-Second-Crate-in-the-Workspace"><a href="#14-3-2-Creating-the-Second-Crate-in-the-Workspace" class="headerlink" title="14.3.2 Creating the Second Crate in the Workspace"></a>14.3.2 Creating the Second Crate in the Workspace</h4><p>Step1: Edit <code>Cargo.toml</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[workspace]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">members</span> = [</span><br><span class="line">    "adder",</span><br><span class="line">    "add-one",</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Step2: Generate a new library crate</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ cargo new add-one --lib</span><br><span class="line"></span><br><span class="line">├── Cargo.lock</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── add-one</span><br><span class="line">│   ├── Cargo.toml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── lib.rs</span><br><span class="line">├── adder</span><br><span class="line">│   ├── Cargo.toml</span><br><span class="line">│   └── src</span><br><span class="line">│       └── main.rs</span><br><span class="line">└── target</span><br></pre></td></tr></table></figure>
<p>Step3: Add function <code>add_one</code> to <code>add-one/src/lib.rs</code></p>
<p>Step4: Add a dependency on <code>add-one</code> to <code>adder/Cargo.toml</code></p>
<p>Step5: Use the <code>add_one</code> function from the <code>add-one</code> crate in the <code>adder</code> crate</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// adder/src/main.rs</span></span><br><span class="line"><span class="keyword">use</span> add_one;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> num = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"Hello, world! &#123;&#125; plus one is &#123;&#125;!"</span>, num, add_one::add_one(num));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Step6: <code>cargo build</code></p>
<p>Step7: <code>cargo run -p adder</code></p>
<p>This runs the code in <em>adder/src/main.rs</em>, which depends on the <code>add-one</code> crate.</p>
<h5 id="14-3-2-1-Depending-on-an-External-Crate-in-a-Workspace"><a href="#14-3-2-1-Depending-on-an-External-Crate-in-a-Workspace" class="headerlink" title="14.3.2.1 Depending on an External Crate in a Workspace"></a>14.3.2.1 Depending on an External Crate in a Workspace</h5><p>Notice that the workspace has only one <em>Cargo.lock</em> file at the top level of the workspace rather than having a <em>Cargo.lock</em> in each crate’s directory. This ensures that all crates are using the same version of all dependencies. If we add the <code>rand</code> crate to the <em>adder/Cargo.toml</em> and <em>add-one/Cargo.toml</em> files, Cargo will resolve both of those to one version of <code>rand</code> and record that in the one <em>Cargo.lock</em>.</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add-one/Cargo.toml</span></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rand</span> = <span class="string">"0.3.14"</span></span><br></pre></td></tr></table></figure>
<p>However, even though <code>rand</code> is used somewhere in the workspace, we can’t use it in other crates in the workspace unless we add <code>rand</code> to their <em>Cargo.toml</em> files as well.</p>
<p>To fix this, edit the <em>Cargo.toml</em> file for the <code>adder</code> crate and indicate that <code>rand</code> is a dependency for that crate as well. Building the <code>adder</code> crate will add <code>rand</code> to the list of dependencies for <code>adder</code> in <em>Cargo.lock</em>, but no additional copies of <code>rand</code> will be downloaded. Cargo has ensured that every crate in the workspace using the <code>rand</code> crate will be using the same version. </p>
<h5 id="14-3-2-2-Adding-a-Test-to-a-Workspace"><a href="#14-3-2-2-Adding-a-Test-to-a-Workspace" class="headerlink" title="14.3.2.2 Adding a Test to a Workspace"></a>14.3.2.2 Adding a Test to a Workspace</h5><p>Running <code>cargo test</code> in a workspace structured like this one will run the tests for all the crates in the workspace.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># only run tests for the add-one</span></span><br><span class="line">$ cargo <span class="built_in">test</span> -p add-one</span><br></pre></td></tr></table></figure>
<p>If you publish the crates in the workspace to <a href="https://crates.io/" target="_blank" rel="noopener">crates.io</a>, each crate in the workspace will need to be published separately. The <code>cargo publish</code> command does not have an <code>--all</code> flag or a <code>-p</code> flag, so you must change to each crate’s directory and run <code>cargo publish</code> on each crate in the workspace to publish the crates.</p>
<p>The whole code can be found <a href="https://github.com/hscspring/Coding-Collections/tree/master/Rust/add" target="_blank" rel="noopener">here</a>.</p>
<h3 id="14-4-Installing-Binaries-from-Crates-io-with-cargo-install"><a href="#14-4-Installing-Binaries-from-Crates-io-with-cargo-install" class="headerlink" title="14.4 Installing Binaries from Crates.io with cargo install"></a>14.4 Installing Binaries from Crates.io with <code>cargo install</code></h3><p>Note that you can only install packages that have binary targets. A <em>binary target</em> is the runnable program that is created if the crate has a <em>src/main.rs</em> file or another file specified as a binary, as opposed to a library target that isn’t runnable on its own but is suitable for including within other programs.</p>
<p>All binaries installed with <code>cargo install</code> are stored in the installation root’s <em>bin</em> folder (<code>~/.cargo/bin</code>).</p>
<h3 id="14-5-Extending-Cargo-with-Custom-Commands"><a href="#14-5-Extending-Cargo-with-Custom-Commands" class="headerlink" title="14.5 Extending Cargo with Custom Commands"></a>14.5 Extending Cargo with Custom Commands</h3><p>Cargo is designed so you can extend it with new subcommands without having to modify Cargo. If a binary in your <code>$PATH</code> is named <code>cargo-something</code>, you can run it as if it was a Cargo subcommand by running <code>cargo something</code>. Custom commands like this are also listed when you run <code>cargo --list</code>. Being able to use <code>cargo install</code> to install extensions and then run them just like the built-in Cargo tools is a super convenient benefit of Cargo’s design!</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/12/10/Rust/2019-12-10-Rust-Programming-Language-Brief-Note-Vol2/">
    <time datetime="2019-12-10T04:00:00.000Z" class="entry-date">
        2019-12-10
    </time>
</a>
    
  <span class="article-delim">&#8226;</span>
  <div class="article-category">
  <a class="article-category-link" href="/categories/Coding/">Coding</a>
  </div>

    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/">Rust</a></li></ul>

    </footer>
</article>


    
<nav class="nav-single">
    <h3 class="assistive-text">文章导航</h3>
    
    
        <span class="nav-next"><a href="/2019/12/09/2019-12-09-AINLP-GPU-Guide/" rel="next">AINLP GPU 使用体验指南 <span class="meta-nav">→</span></a></span>
    
</nav><!-- .nav-single -->







<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a><a href="#" class="bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_evernotecn" data-cmd="evernotecn" title="分享到印象笔记"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{},"image":{"viewList":["fbook","twi","linkedin","qzone","tsina","douban","weixin","evernotecn"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?'];</script>

<section id="comment">
  <!-- 评论代码 -->
  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script>
  const gitalk = new Gitalk({
    clientID: '0eb512031083d6e7edfb',
    clientSecret: 'e830808995dd813ca26fed50573760963457da37',
    repo: 'hscspring.github.io',
    owner: 'hscspring',
    admin: ['hscspring'],
    id: md5(location.pathname),
    distractionFreeMode: false
  })
  gitalk.render('gitalk-container')
  </script>
  <!-- 评论代码已完成 -->
</section>

</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="搜索" />
    </div>
</form></aside>
  
    
  <aside class="widget">
    <h3 class="widget-title">Music</h3>
    <div class="widget-content">
      <audio src="http://qnimg.lovevivian.cn/miss.mp3" controls="controls"
             style="width:100%">
        您的浏览器不支持 audio 标签。
      </audio>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-content">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Coding/">Coding</a><span class="category-list-count">32</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Feeling/">Feeling</a><span class="category-list-count">49</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Thinking/">Thinking</a><span class="category-list-count">13</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2019/12/10/Rust/2019-12-10-Rust-Programming-Language-Brief-Note-Vol2/">The Rust Programming Language Brief Note (Vol2)</a>
          </li>
        
          <li>
            <a href="/2019/12/09/2019-12-09-AINLP-GPU-Guide/">AINLP GPU 使用体验指南</a>
          </li>
        
          <li>
            <a href="/2019/12/08/Paper/2019-12-08-ELECTRA-Paper/">ELECTRA, Pre-Training Text Encoders as Discriminators Rather Than Generators Note</a>
          </li>
        
          <li>
            <a href="/2019/12/03/Rust/2019-12-03-Rust-Programming-Language-Brief-Note-Vol1/">The Rust Programming Language Brief Note (Vol1)</a>
          </li>
        
          <li>
            <a href="/2019/12/02/2019-12-02-NLM/">自然语言记忆模块（NLM）</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-content">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AE/">AE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI/">AI</a><span class="tag-list-count">43</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AR/">AR</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Array/">Array</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Attention/">Attention</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Automatic-Speech-Processing/">Automatic Speech Processing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Backward/">Backward</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bayes/">Bayes</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Beam-Search/">Beam Search</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bert/">Bert</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Binary-Search/">Binary Search</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Business/">Business</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CCG/">CCG</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CFG/">CFG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CKY/">CKY</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CNN/">CNN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CYK/">CYK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Calculus/">Calculus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ChatBot/">ChatBot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chunking/">Chunking</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Code/">Code</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Collins-Parser/">Collins Parser</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Computational-Linguistics/">Computational Linguistics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Computer/">Computer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Computer-Science/">Computer Science</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Context-Free-Grammars/">Context-Free Grammars</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cosine/">Cosine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cross-Entropy/">Cross Entropy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cross-brackets/">Cross-brackets</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ctrl/">Ctrl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/">DB</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DNN/">DNN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DP/">DP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Clearing/">Data Clearing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Science/">Data Science</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Structure/">Data Structure</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/">Database</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Decoding/">Decoding</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DeepLearning/">DeepLearning</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dependence/">Dependence</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Diary/">Diary</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ERNIE/">ERNIE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Economics/">Economics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Edit-Distance/">Edit Distance</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/">Elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Electra/">Electra</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elixir/">Elixir</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Embeddings/">Embeddings</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Entropy/">Entropy</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Evaluation/">Evaluation</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/F1/">F1</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FDW/">FDW</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FSM/">FSM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Feature-based/">Feature-based</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fine-tuning/">Fine-tuning</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Formal-Analysis/">Formal Analysis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Formal-Grammars/">Formal Grammars</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Forward/">Forward</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Full-Text-Search/">Full-Text-Search</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Function-Syntax/">Function Syntax</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPU/">GPU</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRU/">GRU</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gan/">Gan</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Garden-path/">Garden-path</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradient-Descent/">Gradient Descent</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphQL/">GraphQL</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Grid-Grammar/">Grid Grammar</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HMM/">HMM</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IE/">IE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Industry/">Industry</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Information-Extraction/">Information Extraction</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Information-Theory/">Information Theory</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Job/">Job</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Knowledge-Graph/">Knowledge Graph</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LM/">LM</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LSTM/">LSTM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Language-Model/">Language Model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lexical-Semantics/">Lexical Semantics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lexicalism/">Lexicalism</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lexicalized-CFG/">Lexicalized CFG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lexicalized-Grammars/">Lexicalized Grammars</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linear-Algebra/">Linear Algebra</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linear-Sturcture/">Linear Sturcture</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linked-List/">Linked List</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Logistic-Regression/">Logistic Regression</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lucene/">Lucene</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MEMM/">MEMM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Machine/">Machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Machine-Learning/">Machine Learning</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Machine-Translation/">Machine Translation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Manacher/">Manacher</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markov/">Markov</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Materialized-Views/">Materialized Views</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/">Math</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Matplotlib/">Matplotlib</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Median/">Median</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Minimum-Edit-Distance/">Minimum Edit Distance</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Module/">Module</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Multiway-Tree/">Multiway Tree</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NLG/">NLG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NLM/">NLM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NLP/">NLP</a><span class="tag-list-count">46</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NLU/">NLU</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Naive-Bayes/">Naive Bayes</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Neo4j/">Neo4j</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ngram/">Ngram</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NumPy/">NumPy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Occupation/">Occupation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Orientation/">Orientation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PCCG/">PCCG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PCFG/">PCFG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PPMI/">PPMI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Palindromic/">Palindromic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pandas/">Pandas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Paper/">Paper</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Partial-Parsing/">Partial Parsing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Philosophy/">Philosophy</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Phrase-Structure-Grammar/">Phrase Structure Grammar</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Phrase-Structure-Grammars/">Phrase Structure Grammars</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PoS/">PoS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Position-Encoding/">Position-Encoding</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postgres/">Postgres</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pragmatic-Automatic-Processing/">Pragmatic Automatic Processing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pre-training/">Pre-training</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pretraining/">Pretraining</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Probabilistic-Grammar/">Probabilistic Grammar</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Probabilistic-Model/">Probabilistic Model</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PyPI/">PyPI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Query/">Query</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Queue/">Queue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RNN/">RNN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Regex/">Regex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Regular-Expression/">Regular Expression</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reinforcement-Learning/">Reinforcement Learning</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reqular-Expressions/">Reqular Expressions</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rust/">Rust</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SCFG/">SCFG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SGD/">SGD</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SRN/">SRN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Seaborn/">Seaborn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Search/">Search</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Self-Attention/">Self-Attention</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Semantic-Automatic-Processing/">Semantic Automatic Processing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sentiment-Classification/">Sentiment Classification</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Simon/">Simon</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Simpson-Paradox/">Simpson Paradox</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Slide/">Slide</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Smoothing/">Smoothing</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sort/">Sort</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spell-Check/">Spell Check</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stack/">Stack</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Statistics/">Statistics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/">String</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Style/">Style</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Substring/">Substring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Supertagging/">Supertagging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/System/">System</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TF-IDF/">TF-IDF</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tagging/">Tagging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Test/">Test</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Text-Generation/">Text Generation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Text-Normalization/">Text Normalization</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Transformer/">Transformer</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Transformer-XL/">Transformer-XL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tree/">Tree</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Treebank/">Treebank</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/">Ubuntu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity-Operation/">Unity Operation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vagrant/">Vagrant</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Valence/">Valence</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vector-Semantics/">Vector Semantics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VirtualBox/">VirtualBox</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Visualization/">Visualization</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Viterbi/">Viterbi</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Word2vec/">Word2vec</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Work/">Work</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XLNet/">XLNet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ZhouZhihua/">ZhouZhihua</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zipf/">Zipf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/knowledge-Graph/">knowledge Graph</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-content tagcloud">
      <a href="/tags/AE/" style="font-size: 10px;">AE</a> <a href="/tags/AI/" style="font-size: 18.33px;">AI</a> <a href="/tags/AR/" style="font-size: 10px;">AR</a> <a href="/tags/Array/" style="font-size: 10px;">Array</a> <a href="/tags/Attention/" style="font-size: 10px;">Attention</a> <a href="/tags/Automatic-Speech-Processing/" style="font-size: 10px;">Automatic Speech Processing</a> <a href="/tags/Backward/" style="font-size: 10px;">Backward</a> <a href="/tags/Bayes/" style="font-size: 10px;">Bayes</a> <a href="/tags/Beam-Search/" style="font-size: 10px;">Beam Search</a> <a href="/tags/Bert/" style="font-size: 10px;">Bert</a> <a href="/tags/Binary-Search/" style="font-size: 10px;">Binary Search</a> <a href="/tags/Business/" style="font-size: 10px;">Business</a> <a href="/tags/C/" style="font-size: 11.67px;">C</a> <a href="/tags/CCG/" style="font-size: 11.67px;">CCG</a> <a href="/tags/CFG/" style="font-size: 10px;">CFG</a> <a href="/tags/CKY/" style="font-size: 10px;">CKY</a> <a href="/tags/CNN/" style="font-size: 10px;">CNN</a> <a href="/tags/CYK/" style="font-size: 10px;">CYK</a> <a href="/tags/Calculus/" style="font-size: 10px;">Calculus</a> <a href="/tags/ChatBot/" style="font-size: 10px;">ChatBot</a> <a href="/tags/Chunking/" style="font-size: 10px;">Chunking</a> <a href="/tags/Code/" style="font-size: 10px;">Code</a> <a href="/tags/Collins-Parser/" style="font-size: 10px;">Collins Parser</a> <a href="/tags/Computational-Linguistics/" style="font-size: 10px;">Computational Linguistics</a> <a href="/tags/Computer/" style="font-size: 10px;">Computer</a> <a href="/tags/Computer-Science/" style="font-size: 15px;">Computer Science</a> <a href="/tags/Context-Free-Grammars/" style="font-size: 10px;">Context-Free Grammars</a> <a href="/tags/Cosine/" style="font-size: 10px;">Cosine</a> <a href="/tags/Cross-Entropy/" style="font-size: 10px;">Cross Entropy</a> <a href="/tags/Cross-brackets/" style="font-size: 10px;">Cross-brackets</a> <a href="/tags/Ctrl/" style="font-size: 10px;">Ctrl</a> <a href="/tags/DB/" style="font-size: 11.67px;">DB</a> <a href="/tags/DNN/" style="font-size: 10px;">DNN</a> <a href="/tags/DP/" style="font-size: 10px;">DP</a> <a href="/tags/Data-Clearing/" style="font-size: 10px;">Data Clearing</a> <a href="/tags/Data-Science/" style="font-size: 13.33px;">Data Science</a> <a href="/tags/Data-Structure/" style="font-size: 15px;">Data Structure</a> <a href="/tags/Database/" style="font-size: 10px;">Database</a> <a href="/tags/Decoding/" style="font-size: 10px;">Decoding</a> <a href="/tags/DeepLearning/" style="font-size: 15px;">DeepLearning</a> <a href="/tags/Dependence/" style="font-size: 10px;">Dependence</a> <a href="/tags/Diary/" style="font-size: 11.67px;">Diary</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/ERNIE/" style="font-size: 10px;">ERNIE</a> <a href="/tags/Economics/" style="font-size: 10px;">Economics</a> <a href="/tags/Edit-Distance/" style="font-size: 10px;">Edit Distance</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/Electra/" style="font-size: 10px;">Electra</a> <a href="/tags/Elixir/" style="font-size: 11.67px;">Elixir</a> <a href="/tags/Embeddings/" style="font-size: 11.67px;">Embeddings</a> <a href="/tags/Entropy/" style="font-size: 11.67px;">Entropy</a> <a href="/tags/Evaluation/" style="font-size: 11.67px;">Evaluation</a> <a href="/tags/F1/" style="font-size: 10px;">F1</a> <a href="/tags/FDW/" style="font-size: 10px;">FDW</a> <a href="/tags/FSM/" style="font-size: 10px;">FSM</a> <a href="/tags/Feature-based/" style="font-size: 10px;">Feature-based</a> <a href="/tags/Fine-tuning/" style="font-size: 10px;">Fine-tuning</a> <a href="/tags/Formal-Analysis/" style="font-size: 10px;">Formal Analysis</a> <a href="/tags/Formal-Grammars/" style="font-size: 13.33px;">Formal Grammars</a> <a href="/tags/Forward/" style="font-size: 10px;">Forward</a> <a href="/tags/Full-Text-Search/" style="font-size: 10px;">Full-Text-Search</a> <a href="/tags/Function-Syntax/" style="font-size: 10px;">Function Syntax</a> <a href="/tags/GPU/" style="font-size: 10px;">GPU</a> <a href="/tags/GRU/" style="font-size: 10px;">GRU</a> <a href="/tags/Gan/" style="font-size: 10px;">Gan</a> <a href="/tags/Garden-path/" style="font-size: 10px;">Garden-path</a> <a href="/tags/Gradient-Descent/" style="font-size: 10px;">Gradient Descent</a> <a href="/tags/GraphQL/" style="font-size: 11.67px;">GraphQL</a> <a href="/tags/Grid-Grammar/" style="font-size: 10px;">Grid Grammar</a> <a href="/tags/HMM/" style="font-size: 11.67px;">HMM</a> <a href="/tags/IE/" style="font-size: 10px;">IE</a> <a href="/tags/Industry/" style="font-size: 10px;">Industry</a> <a href="/tags/Information-Extraction/" style="font-size: 10px;">Information Extraction</a> <a href="/tags/Information-Theory/" style="font-size: 10px;">Information Theory</a> <a href="/tags/Job/" style="font-size: 10px;">Job</a> <a href="/tags/Knowledge-Graph/" style="font-size: 10px;">Knowledge Graph</a> <a href="/tags/LM/" style="font-size: 11.67px;">LM</a> <a href="/tags/LSTM/" style="font-size: 10px;">LSTM</a> <a href="/tags/Language-Model/" style="font-size: 10px;">Language Model</a> <a href="/tags/Lexical-Semantics/" style="font-size: 10px;">Lexical Semantics</a> <a href="/tags/Lexicalism/" style="font-size: 10px;">Lexicalism</a> <a href="/tags/Lexicalized-CFG/" style="font-size: 10px;">Lexicalized CFG</a> <a href="/tags/Lexicalized-Grammars/" style="font-size: 10px;">Lexicalized Grammars</a> <a href="/tags/Linear-Algebra/" style="font-size: 10px;">Linear Algebra</a> <a href="/tags/Linear-Sturcture/" style="font-size: 10px;">Linear Sturcture</a> <a href="/tags/Linked-List/" style="font-size: 10px;">Linked List</a> <a href="/tags/Logistic-Regression/" style="font-size: 10px;">Logistic Regression</a> <a href="/tags/Lucene/" style="font-size: 10px;">Lucene</a> <a href="/tags/MEMM/" style="font-size: 10px;">MEMM</a> <a href="/tags/Machine/" style="font-size: 10px;">Machine</a> <a href="/tags/Machine-Learning/" style="font-size: 10px;">Machine Learning</a> <a href="/tags/Machine-Translation/" style="font-size: 10px;">Machine Translation</a> <a href="/tags/Manacher/" style="font-size: 10px;">Manacher</a> <a href="/tags/Markov/" style="font-size: 10px;">Markov</a> <a href="/tags/Materialized-Views/" style="font-size: 10px;">Materialized Views</a> <a href="/tags/Math/" style="font-size: 11.67px;">Math</a> <a href="/tags/Matplotlib/" style="font-size: 10px;">Matplotlib</a> <a href="/tags/Median/" style="font-size: 10px;">Median</a> <a href="/tags/Minimum-Edit-Distance/" style="font-size: 10px;">Minimum Edit Distance</a> <a href="/tags/Module/" style="font-size: 10px;">Module</a> <a href="/tags/Multiway-Tree/" style="font-size: 10px;">Multiway Tree</a> <a href="/tags/NLG/" style="font-size: 10px;">NLG</a> <a href="/tags/NLM/" style="font-size: 10px;">NLM</a> <a href="/tags/NLP/" style="font-size: 20px;">NLP</a> <a href="/tags/NLU/" style="font-size: 10px;">NLU</a> <a href="/tags/Naive-Bayes/" style="font-size: 10px;">Naive Bayes</a> <a href="/tags/Neo4j/" style="font-size: 10px;">Neo4j</a> <a href="/tags/Ngram/" style="font-size: 11.67px;">Ngram</a> <a href="/tags/NumPy/" style="font-size: 10px;">NumPy</a> <a href="/tags/Occupation/" style="font-size: 10px;">Occupation</a> <a href="/tags/Orientation/" style="font-size: 10px;">Orientation</a> <a href="/tags/PCCG/" style="font-size: 10px;">PCCG</a> <a href="/tags/PCFG/" style="font-size: 10px;">PCFG</a> <a href="/tags/PPMI/" style="font-size: 10px;">PPMI</a> <a href="/tags/Palindromic/" style="font-size: 10px;">Palindromic</a> <a href="/tags/Pandas/" style="font-size: 10px;">Pandas</a> <a href="/tags/Paper/" style="font-size: 10px;">Paper</a> <a href="/tags/Partial-Parsing/" style="font-size: 10px;">Partial Parsing</a> <a href="/tags/Philosophy/" style="font-size: 11.67px;">Philosophy</a> <a href="/tags/Phrase-Structure-Grammar/" style="font-size: 10px;">Phrase Structure Grammar</a> <a href="/tags/Phrase-Structure-Grammars/" style="font-size: 10px;">Phrase Structure Grammars</a> <a href="/tags/PoS/" style="font-size: 10px;">PoS</a> <a href="/tags/Position-Encoding/" style="font-size: 10px;">Position-Encoding</a> <a href="/tags/Postgres/" style="font-size: 11.67px;">Postgres</a> <a href="/tags/Pragmatic-Automatic-Processing/" style="font-size: 10px;">Pragmatic Automatic Processing</a> <a href="/tags/Pre-training/" style="font-size: 11.67px;">Pre-training</a> <a href="/tags/Pretraining/" style="font-size: 11.67px;">Pretraining</a> <a href="/tags/Probabilistic-Grammar/" style="font-size: 10px;">Probabilistic Grammar</a> <a href="/tags/Probabilistic-Model/" style="font-size: 10px;">Probabilistic Model</a> <a href="/tags/PyPI/" style="font-size: 10px;">PyPI</a> <a href="/tags/Python/" style="font-size: 16.67px;">Python</a> <a href="/tags/Query/" style="font-size: 10px;">Query</a> <a href="/tags/Queue/" style="font-size: 10px;">Queue</a> <a href="/tags/RNN/" style="font-size: 10px;">RNN</a> <a href="/tags/Regex/" style="font-size: 10px;">Regex</a> <a href="/tags/Regular-Expression/" style="font-size: 10px;">Regular Expression</a> <a href="/tags/Reinforcement-Learning/" style="font-size: 10px;">Reinforcement Learning</a> <a href="/tags/Reqular-Expressions/" style="font-size: 10px;">Reqular Expressions</a> <a href="/tags/Rust/" style="font-size: 11.67px;">Rust</a> <a href="/tags/SCFG/" style="font-size: 10px;">SCFG</a> <a href="/tags/SGD/" style="font-size: 10px;">SGD</a> <a href="/tags/SQL/" style="font-size: 11.67px;">SQL</a> <a href="/tags/SRN/" style="font-size: 10px;">SRN</a> <a href="/tags/Seaborn/" style="font-size: 10px;">Seaborn</a> <a href="/tags/Search/" style="font-size: 10px;">Search</a> <a href="/tags/Self-Attention/" style="font-size: 10px;">Self-Attention</a> <a href="/tags/Semantic-Automatic-Processing/" style="font-size: 10px;">Semantic Automatic Processing</a> <a href="/tags/Sentiment-Classification/" style="font-size: 10px;">Sentiment Classification</a> <a href="/tags/Simon/" style="font-size: 10px;">Simon</a> <a href="/tags/Simpson-Paradox/" style="font-size: 10px;">Simpson Paradox</a> <a href="/tags/Slide/" style="font-size: 10px;">Slide</a> <a href="/tags/Smoothing/" style="font-size: 11.67px;">Smoothing</a> <a href="/tags/Sort/" style="font-size: 11.67px;">Sort</a> <a href="/tags/Spell-Check/" style="font-size: 10px;">Spell Check</a> <a href="/tags/Stack/" style="font-size: 10px;">Stack</a> <a href="/tags/Statistics/" style="font-size: 10px;">Statistics</a> <a href="/tags/String/" style="font-size: 10px;">String</a> <a href="/tags/Style/" style="font-size: 10px;">Style</a> <a href="/tags/Substring/" style="font-size: 10px;">Substring</a> <a href="/tags/Supertagging/" style="font-size: 10px;">Supertagging</a> <a href="/tags/System/" style="font-size: 11.67px;">System</a> <a href="/tags/TF-IDF/" style="font-size: 10px;">TF-IDF</a> <a href="/tags/Tagging/" style="font-size: 10px;">Tagging</a> <a href="/tags/Test/" style="font-size: 10px;">Test</a> <a href="/tags/Text-Generation/" style="font-size: 10px;">Text Generation</a> <a href="/tags/Text-Normalization/" style="font-size: 10px;">Text Normalization</a> <a href="/tags/Transformer/" style="font-size: 15px;">Transformer</a> <a href="/tags/Transformer-XL/" style="font-size: 10px;">Transformer-XL</a> <a href="/tags/Tree/" style="font-size: 10px;">Tree</a> <a href="/tags/Treebank/" style="font-size: 10px;">Treebank</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/Unity-Operation/" style="font-size: 10px;">Unity Operation</a> <a href="/tags/Vagrant/" style="font-size: 10px;">Vagrant</a> <a href="/tags/Valence/" style="font-size: 10px;">Valence</a> <a href="/tags/Vector-Semantics/" style="font-size: 10px;">Vector Semantics</a> <a href="/tags/VirtualBox/" style="font-size: 10px;">VirtualBox</a> <a href="/tags/Visualization/" style="font-size: 10px;">Visualization</a> <a href="/tags/Viterbi/" style="font-size: 11.67px;">Viterbi</a> <a href="/tags/Word2vec/" style="font-size: 10px;">Word2vec</a> <a href="/tags/Work/" style="font-size: 10px;">Work</a> <a href="/tags/XLNet/" style="font-size: 10px;">XLNet</a> <a href="/tags/ZhouZhihua/" style="font-size: 10px;">ZhouZhihua</a> <a href="/tags/Zipf/" style="font-size: 10px;">Zipf</a> <a href="/tags/knowledge-Graph/" style="font-size: 10px;">knowledge Graph</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a>
    </div>
  </aside>

  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2019 Yam
    All rights reserved.</p>
    <p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></p>
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <!-- <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span> -->
    <!-- <span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span>次</span> -->
    <!-- <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span> -->

</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>